<!DOCTYPE html>
<html>
	<head>
		<title>Basic Scene with Environment - A-Frame</title>
		<meta name="description" content="Basic Scene with Environment - A-Frame" />
		<script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/aframe-blink-controls/dist/aframe-blink-controls.min.js"></script>
		<script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
		<script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
		<script>
			AFRAME.registerComponent('click', {
				schema: {},

				init: function () {
					let el = this.el
					this.el.addEventListener('click', function () {
						el.object3D.rotateZ(1.1)
						el.object3D.rotateY(1.1)
					})
				},
			})

			AFRAME.registerComponent('hover', {
				schema: {
					color: {default: 'red'},
					text: {default: 'text'},
					tipColor: {default: 'yellow'},
				},

				init: function () {
					var data = this.data
					var el = this.el // <a-box>
					var defaultColor = el.getAttribute('material').color

					el.addEventListener('mouseenter', function () {
						el.setAttribute('color', data.color)
						let tooltip = document.createElement('a-entity')
						tooltip.id = 'tooltip'
						tooltip.setAttribute('text', {
							value: data.text,
							color: data.tipColor,
							width: 2,
							anchor: 'center',
							align: 'center',
						})
						tooltip.setAttribute('scale', {x: 2, y: 2, z: 2})
						const mesh = el.getObject3D('mesh')
						// the timeout is an ugly hack,
						// the bounding sphere isn't set yet
						//            setTimeout(evt => {
						const bsphere = mesh.geometry.boundingSphere
						const sphericalrig = document.createElement('a-sphere')
						sphericalrig.id = 'sphericalrig'
						sphericalrig.setAttribute('look-at', '[camera]')
						sphericalrig.setAttribute('material', 'wireframe', true)
						sphericalrig.setAttribute('opacity', 0)
						el.appendChild(sphericalrig)
						tooltip.setAttribute('position', {x: 0, y: 0, z: bsphere.radius})
						sphericalrig.appendChild(tooltip)
						//           }, 150)
					})
					el.addEventListener('mouseleave', function () {
						el.setAttribute('color', defaultColor)
						let sphericalrig = el.querySelector('#sphericalrig')
						if (sphericalrig) el.removeChild(sphericalrig)
					})
				},
			})
		</script>
	</head>
	<body>
		<a-scene>
			<a-assets>
				<img
					id="skyTexture"
					src="https://upload.wikimedia.org/wikipedia/commons/b/b3/Solarsystemscope_texture_8k_earth_nightmap.jpg"
					crossorigin="anonymous"
				/>
				<img
					id="groundTexture"
					src="https://cdn.aframe.io/a-painter/images/floor.jpg"
					crossorigin="anonymous"
				/>
			</a-assets>
			<a-box
				class="collidable"
				color="red"
				position="2 2 -5"
				rotation="0 0 0"
				scale="1 1 1"
				click
				hover="color: blue; text: red cube"
			></a-box>
			<a-box
				class="collidable"
				color="green"
				position="-2 2 -5"
				rotation="0 0 0"
				scale="1 1 1"
				click
				hover="color: blue; text: green cube"
			></a-box>
			<a-entity
				id="Hello"
				text="value: Hello, A-Frame; color: #FAFAFA; width: 5; anchor: align"
				position="-0.9 0.2 -3"
				scale="1.5 1.5 1.5"
			></a-entity>
			<a-entity id="cameraRig" movement-controls>
				<a-camera id="camera" look-controls="pointerLockEnabled: true">
					<a-cursor color="#FF0000" raycaster="objects: .collidable"></a-cursor>
				</a-camera>
				<a-entity
					id="left-hand"
					oculus-touch-controls="hand: left"
					blink-controls="cameraRig: #cameraRig; teleportOrigin: #camera; button: trigger; snapTurn: false"
				></a-entity>
				<a-entity laser-controls="hand: right" raycaster="objects: .collidable"></a-entity>
			</a-entity>
			<a-plane src="#groundTexture" rotation="-90 0 0" width="5" height="5" repeat="10 10"></a-plane>
			<a-entity id="origin">
				<a-sphere color="lightgray" radius="0.05"></a-sphere>
				<a-entity line="start: -500 0 0; end: 500 0 0; color: red"></a-entity>
				<a-entity line="start: 0 -500 0; end: 0 500 0; color: green"></a-entity>
				<a-entity line="start: 0 0 -500; end: 0 0 500; color: blue"></a-entity>
			</a-entity>
			<a-sky src="#skyTexture"></a-sky>
		</a-scene>
	</body>
</html>
