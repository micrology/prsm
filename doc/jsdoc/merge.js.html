<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>merge.js - Documentation</title>

		<script src="scripts/prettify/prettify.js"></script>
		<script src="scripts/prettify/lang-css.js"></script>
		<!--[if lt IE 9]>
			<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		<link type="text/css" rel="stylesheet" href="styles/prettify.css" />
		<link type="text/css" rel="stylesheet" href="styles/jsdoc.css" />
		<script src="scripts/nav.js" defer></script>

		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	</head>
	<body>
		<input type="checkbox" id="nav-trigger" class="nav-trigger" />
		<label for="nav-trigger" class="navicon-button x">
			<div class="navicon"></div>
		</label>

		<label for="nav-trigger" class="overlay"></label>

		<nav>
			<h2><a href="index.html">Home</a></h2>
			<h3>Classes</h3>
			<ul>
				<li>
					<a href="ToolHandler.html">ToolHandler</a>
					<ul class="methods">
						<li data-type="method"><a href="ToolHandler.html#endPosition">endPosition</a></li>
						<li data-type="method"><a href="ToolHandler.html#options">options</a></li>
						<li data-type="method"><a href="ToolHandler.html#optionsDialog">optionsDialog</a></li>
						<li data-type="method"><a href="ToolHandler.html#panend">panend</a></li>
						<li data-type="method"><a href="ToolHandler.html#panmove">panmove</a></li>
						<li data-type="method"><a href="ToolHandler.html#panstart">panstart</a></li>
					</ul>
				</li>
				<li><a href="module.exports.html">exports</a></li>
			</ul>
			<h3>Global</h3>
			<ul>
				<li><a href="global.html#DOMtoCanvasX">DOMtoCanvasX</a></li>
				<li><a href="global.html#MIN_WIDTH">MIN_WIDTH</a></li>
				<li><a href="global.html#SHORTLABELLEN">SHORTLABELLEN</a></li>
				<li><a href="global.html#TITLELISTLEN">TITLELISTLEN</a></li>
				<li><a href="global.html#addColumn">addColumn</a></li>
				<li><a href="global.html#addContextMenu">addContextMenu</a></li>
				<li><a href="global.html#addEventListeners">addEventListeners</a></li>
				<li><a href="global.html#addLabel">addLabel</a></li>
				<li><a href="global.html#addRollbackIcon">addRollbackIcon</a></li>
				<li><a href="global.html#addVec">addVec</a></li>
				<li><a href="global.html#alertMsg">alertMsg</a></li>
				<li><a href="global.html#analyse">analyse</a></li>
				<li><a href="global.html#anon">anon</a></li>
				<li><a href="global.html#antMarch">antMarch</a></li>
				<li><a href="global.html#applyOptions">applyOptions</a></li>
				<li><a href="global.html#applySampleToLink">applySampleToLink</a></li>
				<li><a href="global.html#arrayBufferToString">arrayBufferToString</a></li>
				<li><a href="global.html#asleep">asleep</a></li>
				<li><a href="global.html#autoLayout">autoLayout</a></li>
				<li><a href="global.html#buttonIsDisabled">buttonIsDisabled</a></li>
				<li><a href="global.html#cancelAdd">cancelAdd</a></li>
				<li><a href="global.html#cancelEdit">cancelEdit</a></li>
				<li><a href="global.html#cancelHiddenStyles">cancelHiddenStyles</a></li>
				<li><a href="global.html#cancelLoading">cancelLoading</a></li>
				<li><a href="global.html#cancelViewOnly">cancelViewOnly</a></li>
				<li><a href="global.html#changeCursor">changeCursor</a></li>
				<li><a href="global.html#changeRoom">changeRoom</a></li>
				<li><a href="global.html#checkKey">checkKey</a></li>
				<li><a href="global.html#circleIntersectsRect">circleIntersectsRect</a></li>
				<li><a href="global.html#clean">clean</a></li>
				<li><a href="global.html#cleanArray">cleanArray</a></li>
				<li><a href="global.html#clearLegend">clearLegend</a></li>
				<li><a href="global.html#clearMap">clearMap</a></li>
				<li><a href="global.html#clearPopUp">clearPopUp</a></li>
				<li><a href="global.html#clearStatusBar">clearStatusBar</a></li>
				<li><a href="global.html#closeFilter">closeFilter</a></li>
				<li><a href="global.html#closeOptionsDialogs">closeOptionsDialogs</a></li>
				<li><a href="global.html#clusterByAttribute">clusterByAttribute</a></li>
				<li><a href="global.html#collapseColGroup">collapseColGroup</a></li>
				<li><a href="global.html#collapseNotes">collapseNotes</a></li>
				<li><a href="global.html#colorEditor">colorEditor</a></li>
				<li><a href="global.html#connected">connected</a></li>
				<li><a href="global.html#connectedComponents">connectedComponents</a></li>
				<li><a href="global.html#convertDashes">convertDashes</a></li>
				<li><a href="global.html#convertData">convertData</a></li>
				<li><a href="global.html#convertEdge">convertEdge</a></li>
				<li><a href="global.html#convertEdgeBack">convertEdgeBack</a></li>
				<li><a href="global.html#convertNode">convertNode</a></li>
				<li><a href="global.html#convertNodeBack">convertNodeBack</a></li>
				<li><a href="global.html#copyBackgroundToClipboard">copyBackgroundToClipboard</a></li>
				<li><a href="global.html#copyHistoryToClipboard">copyHistoryToClipboard</a></li>
				<li><a href="global.html#copyTable">copyTable</a></li>
				<li><a href="global.html#copyToClipboard">copyToClipboard</a></li>
				<li><a href="global.html#createTitleDropDown">createTitleDropDown</a></li>
				<li><a href="global.html#deepCopy">deepCopy</a></li>
				<li><a href="global.html#deleteActiveObjects">deleteActiveObjects</a></li>
				<li><a href="global.html#deleteColumn">deleteColumn</a></li>
				<li><a href="global.html#deleteNode">deleteNode</a></li>
				<li><a href="global.html#deselectTool">deselectTool</a></li>
				<li><a href="global.html#diag">diag</a></li>
				<li><a href="global.html#diffMaps">diffMaps</a></li>
				<li><a href="global.html#display">display</a></li>
				<li><a href="global.html#displayHelp">displayHelp</a></li>
				<li><a href="global.html#displayNetPane">displayNetPane</a></li>
				<li><a href="global.html#displayWhatsNew">displayWhatsNew</a></li>
				<li><a href="global.html#doSearch">doSearch</a></li>
				<li><a href="global.html#dragElement">dragElement</a></li>
				<li><a href="global.html#draw">draw</a></li>
				<li><a href="global.html#drawBadges">drawBadges</a></li>
				<li><a href="global.html#drawGrid">drawGrid</a></li>
				<li><a href="global.html#drawMinimap">drawMinimap</a></li>
				<li><a href="global.html#duplEdge">duplEdge</a></li>
				<li><a href="global.html#edgeListToAdjMatrix">edgeListToAdjMatrix</a></li>
				<li><a href="global.html#editEdge">editEdge</a></li>
				<li><a href="global.html#editLinkStyle">editLinkStyle</a></li>
				<li><a href="global.html#editNode">editNode</a></li>
				<li><a href="global.html#editNodeStyle">editNodeStyle</a></li>
				<li><a href="global.html#elem">elem</a></li>
				<li><a href="global.html#eraser">eraser</a></li>
				<li><a href="global.html#exactTime">exactTime</a></li>
				<li><a href="global.html#expandStylesObject">expandStylesObject</a></li>
				<li><a href="global.html#exportDOT">exportDOT</a></li>
				<li><a href="global.html#exportExcel">exportExcel</a></li>
				<li><a href="global.html#exportGEXF">exportGEXF</a></li>
				<li><a href="global.html#exportGML">exportGML</a></li>
				<li><a href="global.html#exportNotes">exportNotes</a></li>
				<li><a href="global.html#factorSizeToPercent">factorSizeToPercent</a></li>
				<li><a href="global.html#fit">fit</a></li>
				<li><a href="global.html#follow">follow</a></li>
				<li><a href="global.html#followUser">followUser</a></li>
				<li><a href="global.html#generateName">generateName</a></li>
				<li><a href="global.html#generateRoom">generateRoom</a></li>
				<li><a href="global.html#getArrows">getArrows</a></li>
				<li><a href="global.html#getButtonStatus">getButtonStatus</a></li>
				<li><a href="global.html#getContext">getContext</a></li>
				<li><a href="global.html#getDashes">getDashes</a></li>
				<li><a href="global.html#getLastPath">getLastPath</a></li>
				<li><a href="global.html#getNodeGroupFromGroupLabel">getNodeGroupFromGroupLabel</a></li>
				<li><a href="global.html#getRadioVal">getRadioVal</a></li>
				<li><a href="global.html#getRandomData">getRandomData</a></li>
				<li><a href="global.html#getScaleFreeNetwork">getScaleFreeNetwork</a></li>
				<li><a href="global.html#getSelectedAndFixedNodes">getSelectedAndFixedNodes</a></li>
				<li><a href="global.html#getWidthOfTitle">getWidthOfTitle</a></li>
				<li><a href="global.html#get_trophic_levels">get_trophic_levels</a></li>
				<li><a href="global.html#ghostCursor">ghostCursor</a></li>
				<li><a href="global.html#ghostFactor">ghostFactor</a></li>
				<li><a href="global.html#groupTitle">groupTitle</a></li>
				<li><a href="global.html#headerTickToggle">headerTickToggle</a></li>
				<li><a href="global.html#hideNavButtons">hideNavButtons</a></li>
				<li><a href="global.html#hideNodeAndEdges">hideNodeAndEdges</a></li>
				<li><a href="global.html#hideNotes">hideNotes</a></li>
				<li><a href="global.html#hideWhatsNew">hideWhatsNew</a></li>
				<li><a href="global.html#htmlEntities">htmlEntities</a></li>
				<li><a href="global.html#humanSize">humanSize</a></li>
				<li><a href="global.html#inAddMode">inAddMode</a></li>
				<li><a href="global.html#in_degree">in_degree</a></li>
				<li><a href="global.html#initDraw">initDraw</a></li>
				<li><a href="global.html#initPopUp">initPopUp</a></li>
				<li><a href="global.html#initSample">initSample</a></li>
				<li><a href="global.html#initialiseFactorTable">initialiseFactorTable</a></li>
				<li><a href="global.html#initialiseLinkTable">initialiseLinkTable</a></li>
				<li><a href="global.html#initials">initials</a></li>
				<li><a href="global.html#initiateClone">initiateClone</a></li>
				<li><a href="global.html#inline">inline</a></li>
				<li><a href="global.html#intersect">intersect</a></li>
				<li><a href="global.html#invertColor">invertColor</a></li>
				<li><a href="global.html#isEmpty">isEmpty</a></li>
				<li><a href="global.html#isNotCluster">isNotCluster</a></li>
				<li><a href="global.html#isQuillEmpty">isQuillEmpty</a></li>
				<li><a href="global.html#keepPaneInWindow">keepPaneInWindow</a></li>
				<li><a href="global.html#legend">legend</a></li>
				<li><a href="global.html#legendData">legendData</a></li>
				<li><a href="global.html#lightOrDark">lightOrDark</a></li>
				<li><a href="global.html#linkEditCancel">linkEditCancel</a></li>
				<li><a href="global.html#linkEditSave">linkEditSave</a></li>
				<li><a href="global.html#linkEditSubmit">linkEditSubmit</a></li>
				<li><a href="global.html#linkEditUpdateStyleSample">linkEditUpdateStyleSample</a></li>
				<li><a href="global.html#linkEditorHide">linkEditorHide</a></li>
				<li><a href="global.html#linkEditorShow">linkEditorShow</a></li>
				<li><a href="global.html#listFactors">listFactors</a></li>
				<li><a href="global.html#listLinks">listLinks</a></li>
				<li><a href="global.html#listen">listen</a></li>
				<li><a href="global.html#loadCSV">loadCSV</a></li>
				<li><a href="global.html#loadDOTfile">loadDOTfile</a></li>
				<li><a href="global.html#loadExcelfile">loadExcelfile</a></li>
				<li><a href="global.html#loadFile">loadFile</a></li>
				<li><a href="global.html#loadGEXFfile">loadGEXFfile</a></li>
				<li><a href="global.html#loadGML">loadGML</a></li>
				<li><a href="global.html#loadGraphML">loadGraphML</a></li>
				<li><a href="global.html#loadPRSMfile">loadPRSMfile</a></li>
				<li><a href="global.html#lockNode">lockNode</a></li>
				<li><a href="global.html#logHistory">logHistory</a></li>
				<li><a href="global.html#makeClusterNode">makeClusterNode</a></li>
				<li><a href="global.html#makeColor">makeColor</a></li>
				<li><a href="global.html#makeOptionsDialog">makeOptionsDialog</a></li>
				<li><a href="global.html#mapTitle">mapTitle</a></li>
				<li><a href="global.html#markMapSaved">markMapSaved</a></li>
				<li><a href="global.html#maxScale">maxScale</a></li>
				<li><a href="global.html#mergeTranspose">mergeTranspose</a></li>
				<li><a href="global.html#mouseDespatch">mouseDespatch</a></li>
				<li><a href="global.html#nodeEditCancel">nodeEditCancel</a></li>
				<li><a href="global.html#nodeEditSave">nodeEditSave</a></li>
				<li><a href="global.html#nodeEditSubmit">nodeEditSubmit</a></li>
				<li><a href="global.html#nodeEditUpdateStyleSample">nodeEditUpdateStyleSample</a></li>
				<li><a href="global.html#nodeEditorHide">nodeEditorHide</a></li>
				<li><a href="global.html#nodeEditorShow">nodeEditorShow</a></li>
				<li><a href="global.html#nodeIdToLabel">nodeIdToLabel</a></li>
				<li><a href="global.html#nodeList">nodeList</a></li>
				<li><a href="global.html#noteFilter">noteFilter</a></li>
				<li><a href="global.html#object_equals">object_equals</a></li>
				<li><a href="global.html#onexit">onexit</a></li>
				<li><a href="global.html#openCluster">openCluster</a></li>
				<li><a href="global.html#openNotesWindow">openNotesWindow</a></li>
				<li><a href="global.html#out_degree">out_degree</a></li>
				<li><a href="global.html#plusLink">plusLink</a></li>
				<li><a href="global.html#plusNode">plusNode</a></li>
				<li><a href="global.html#portrait">portrait</a></li>
				<li><a href="global.html#positionNotes">positionNotes</a></li>
				<li><a href="global.html#positionPopUp">positionPopUp</a></li>
				<li><a href="global.html#progressBar">progressBar</a></li>
				<li><a href="global.html#quillAccessor">quillAccessor</a></li>
				<li><a href="global.html#quillEditor">quillEditor</a></li>
				<li><a href="global.html#quillFormatter">quillFormatter</a></li>
				<li><a href="global.html#randomColour">randomColour</a></li>
				<li><a href="global.html#reApplySampleToLinks">reApplySampleToLinks</a></li>
				<li><a href="global.html#reApplySampleToNodes">reApplySampleToNodes</a></li>
				<li><a href="global.html#readSingleFile">readSingleFile</a></li>
				<li><a href="global.html#rebase">rebase</a></li>
				<li><a href="global.html#recalculateStats">recalculateStats</a></li>
				<li><a href="global.html#receiveEvent">receiveEvent</a></li>
				<li><a href="global.html#recreateClusteringMenu">recreateClusteringMenu</a></li>
				<li><a href="global.html#redraw">redraw</a></li>
				<li><a href="global.html#refreshFromMap">refreshFromMap</a></li>
				<li><a href="global.html#refreshSampleLink">refreshSampleLink</a></li>
				<li><a href="global.html#refreshSampleNode">refreshSampleNode</a></li>
				<li><a href="global.html#removeAvatar">removeAvatar</a></li>
				<li><a href="global.html#removeFactorCursor">removeFactorCursor</a></li>
				<li><a href="global.html#removeTitleDropDown">removeTitleDropDown</a></li>
				<li><a href="global.html#renameUser">renameUser</a></li>
				<li><a href="global.html#resizeBox">resizeBox</a></li>
				<li><a href="global.html#resizeCanvas">resizeCanvas</a></li>
				<li><a href="global.html#rgbIsLight">rgbIsLight</a></li>
				<li><a href="global.html#rgbToArray">rgbToArray</a></li>
				<li><a href="global.html#rgba">rgba</a></li>
				<li><a href="global.html#rollback">rollback</a></li>
				<li><a href="global.html#round">round</a></li>
				<li><a href="global.html#roundTripTimer">roundTripTimer</a></li>
				<li><a href="global.html#saveChange">saveChange</a></li>
				<li><a href="global.html#saveEdge">saveEdge</a></li>
				<li><a href="global.html#saveLabel">saveLabel</a></li>
				<li><a href="global.html#saveNode">saveNode</a></li>
				<li><a href="global.html#savePRSMfile">savePRSMfile</a></li>
				<li><a href="global.html#saveState">saveState</a></li>
				<li><a href="global.html#saveStr">saveStr</a></li>
				<li><a href="global.html#saveUserName">saveUserName</a></li>
				<li><a href="global.html#search">search</a></li>
				<li><a href="global.html#searchTargets">searchTargets</a></li>
				<li><a href="global.html#selectClustering">selectClustering</a></li>
				<li><a href="global.html#selectTool">selectTool</a></li>
				<li><a href="global.html#selectUsersItems">selectUsersItems</a></li>
				<li><a href="global.html#selectedLabels">selectedLabels</a></li>
				<li><a href="global.html#setAnalysisButtonsFromRemote">setAnalysisButtonsFromRemote</a></li>
				<li><a href="global.html#setButtonDisabledStatus">setButtonDisabledStatus</a></li>
				<li><a href="global.html#setButtonStatus">setButtonStatus</a></li>
				<li><a href="global.html#setCanvasBackground">setCanvasBackground</a></li>
				<li><a href="global.html#setEdgeHidden">setEdgeHidden</a></li>
				<li><a href="global.html#setEndOfContenteditable">setEndOfContenteditable</a></li>
				<li><a href="global.html#setFactorSizeFromPercent">setFactorSizeFromPercent</a></li>
				<li><a href="global.html#setFileName">setFileName</a></li>
				<li><a href="global.html#setFixed">setFixed</a></li>
				<li><a href="global.html#setMapTitle">setMapTitle</a></li>
				<li><a href="global.html#setNodeHidden">setNodeHidden</a></li>
				<li><a href="global.html#setParams">setParams</a></li>
				<li><a href="global.html#setRadioVal">setRadioVal</a></li>
				<li><a href="global.html#setUpAwareness">setUpAwareness</a></li>
				<li><a href="global.html#setUpBackground">setUpBackground</a></li>
				<li><a href="global.html#setUpCanvas">setUpCanvas</a></li>
				<li><a href="global.html#setUpFilter">setUpFilter</a></li>
				<li><a href="global.html#setUpPage">setUpPage</a></li>
				<li><a href="global.html#setUpPaint">setUpPaint</a></li>
				<li><a href="global.html#setUpSamples">setUpSamples</a></li>
				<li><a href="global.html#setUpShareDialog">setUpShareDialog</a></li>
				<li><a href="global.html#setUpSideDrawer">setUpSideDrawer</a></li>
				<li><a href="global.html#setUpTabs">setUpTabs</a></li>
				<li><a href="global.html#setUpToolbox">setUpToolbox</a></li>
				<li><a href="global.html#setUpTutorial">setUpTutorial</a></li>
				<li><a href="global.html#setUpUserName">setUpUserName</a></li>
				<li><a href="global.html#setvh">setvh</a></li>
				<li><a href="global.html#showAvatars">showAvatars</a></li>
				<li><a href="global.html#showClusterLinks">showClusterLinks</a></li>
				<li><a href="global.html#showGhostFactor">showGhostFactor</a></li>
				<li><a href="global.html#showHistory">showHistory</a></li>
				<li><a href="global.html#showNavButtons">showNavButtons</a></li>
				<li><a href="global.html#showNodeData">showNodeData</a></li>
				<li><a href="global.html#showNodeOrEdgeData">showNodeOrEdgeData</a></li>
				<li><a href="global.html#showNotesSwitch">showNotesSwitch</a></li>
				<li><a href="global.html#showOtherMouse">showOtherMouse</a></li>
				<li><a href="global.html#showPressed">showPressed</a></li>
				<li><a href="global.html#showSelected">showSelected</a></li>
				<li><a href="global.html#snapToGrid">snapToGrid</a></li>
				<li><a href="global.html#solve">solve</a></li>
				<li><a href="global.html#splitText">splitText</a></li>
				<li><a href="global.html#standardize_color">standardize_color</a></li>
				<li><a href="global.html#start">start</a></li>
				<li><a href="global.html#startY">startY</a></li>
				<li><a href="global.html#startzoom">startzoom</a></li>
				<li><a href="global.html#statusMsg">statusMsg</a></li>
				<li><a href="global.html#stepFinish">stepFinish</a></li>
				<li><a href="global.html#stepStart">stepStart</a></li>
				<li><a href="global.html#stepsEnd">stepsEnd</a></li>
				<li><a href="global.html#stopEdit">stopEdit</a></li>
				<li><a href="global.html#strip">strip</a></li>
				<li><a href="global.html#stripNL">stripNL</a></li>
				<li><a href="global.html#styleEdgeContextMenu">styleEdgeContextMenu</a></li>
				<li><a href="global.html#styleEdgeNames">styleEdgeNames</a></li>
				<li><a href="global.html#styleNodeContextMenu">styleNodeContextMenu</a></li>
				<li><a href="global.html#styleNodeNames">styleNodeNames</a></li>
				<li><a href="global.html#subVec">subVec</a></li>
				<li><a href="global.html#subtract">subtract</a></li>
				<li><a href="global.html#sumVec">sumVec</a></li>
				<li><a href="global.html#svg">svg</a></li>
				<li><a href="global.html#tickToggle">tickToggle</a></li>
				<li><a href="global.html#timeAndDate">timeAndDate</a></li>
				<li><a href="global.html#timekey">timekey</a></li>
				<li><a href="global.html#timestamp">timestamp</a></li>
				<li><a href="global.html#toggleDeleteButton">toggleDeleteButton</a></li>
				<li><a href="global.html#toggleNodeStyleLock">toggleNodeStyleLock</a></li>
				<li><a href="global.html#togglePanel">togglePanel</a></li>
				<li><a href="global.html#toolHandler">toolHandler</a></li>
				<li><a href="global.html#traceUsers">traceUsers</a></li>
				<li><a href="global.html#transpose">transpose</a></li>
				<li><a href="global.html#trophic">trophic</a></li>
				<li><a href="global.html#unFollow">unFollow</a></li>
				<li><a href="global.html#unSelect">unSelect</a></li>
				<li><a href="global.html#undirected">undirected</a></li>
				<li><a href="global.html#unlockAll">unlockAll</a></li>
				<li><a href="global.html#unlockEdge">unlockEdge</a></li>
				<li><a href="global.html#unlockNode">unlockNode</a></li>
				<li><a href="global.html#unselectTool">unselectTool</a></li>
				<li><a href="global.html#updateActiveButtons">updateActiveButtons</a></li>
				<li><a href="global.html#updateColumnTitle">updateColumnTitle</a></li>
				<li><a href="global.html#updateEdgeCellData">updateEdgeCellData</a></li>
				<li><a href="global.html#updateFactorsOrLinksHiddenByStyle">updateFactorsOrLinksHiddenByStyle</a></li>
				<li><a href="global.html#updateFilter">updateFilter</a></li>
				<li><a href="global.html#updateFromAndToLabels">updateFromAndToLabels</a></li>
				<li><a href="global.html#updateFromDrawingMap">updateFromDrawingMap</a></li>
				<li><a href="global.html#updateFromRemote">updateFromRemote</a></li>
				<li><a href="global.html#updateLastSamples">updateLastSamples</a></li>
				<li><a href="global.html#updateLegend">updateLegend</a></li>
				<li><a href="global.html#updateLinkEditor">updateLinkEditor</a></li>
				<li><a href="global.html#updateNodeCellData">updateNodeCellData</a></li>
				<li><a href="global.html#updateNodeEditor">updateNodeEditor</a></li>
				<li><a href="global.html#updateSelection">updateSelection</a></li>
				<li><a href="global.html#upgradeFromV1">upgradeFromV1</a></li>
				<li><a href="global.html#uuidv4">uuidv4</a></li>
				<li><a href="global.html#yjsTrace">yjsTrace</a></li>
				<li><a href="global.html#zero">zero</a></li>
				<li><a href="global.html#zoomCanvas">zoomCanvas</a></li>
				<li><a href="global.html#zoomincr">zoomincr</a></li>
				<li><a href="global.html#zoomnet">zoomnet</a></li>
				<li><a href="global.html#zoomscroll">zoomscroll</a></li>
				<li><a href="global.html#zoomset">zoomset</a></li>
			</ul>
		</nav>

		<div id="main">
			<h1 class="page-title">merge.js</h1>

			<section>
				<article>
					<pre class="prettyprint source linenums"><code>/**
 * Some functions for examining and merging maps - not for public consumption, but useful
 * for diagnosing problems and for special operations on maps
 */

import * as Y from 'yjs'
import { WebsocketProvider } from 'y-websocket'
import { DataSet } from 'vis-data/peer'
import { doc, websocket, data, logHistory, room } from './prsm.js'
import { uuidv4, deepCopy, object_equals, alertMsg } from './utils.js'
/* --------------------------------- Merge maps ----------------------------- */
/*
 * Evaluate mergeRoom(string: room code) e.g. mergeRoom('WBI-CRD-ROB-XDK')
 *   adds all factors and links in the 'other' map to this one
 *   if a factor occurs in both maps and is identical in both, nothing is added
 *   if a factor is in both maps, but the label is different, a new factor is added
 *     that is a clone of the 'other' factor, but with a dashed red border and with
 *     cloned links that are dashed.
 *
 * Evaluate diffRoom(string: room code) e.g. diffRoom('WBI-CRD-ROB-XDK')
 *  to list all the differences in the console
 */

var bwsp //  websocket to other room
var bdata // the data from the other room
var bNodesMap // map of nodes from the other room
var bEdgesMap //  map of edges from the other room

export function openOtherDoc(otherRoom) {
	let bDoc = new Y.Doc()
	bwsp = new WebsocketProvider(websocket, `prsm${otherRoom}`, bDoc)
	bwsp.disconnectBc()
	bNodesMap = bDoc.getMap('nodes')
	bEdgesMap = bDoc.getMap('edges')
	let bNodes = new DataSet()
	let bEdges = new DataSet()
	bdata = {
		nodes: bNodes,
		edges: bEdges,
	}
}

function mergeMaps() {
	let history = '' // collect history log entries, so that the log can be updated all at once
	doc.transact(() => {
		let nodesToAdd = [] // collect new nodes to add to map A
		let edgesToAdd = [] // and edges
		let substitutes = new Map() // when two nodes have different ids, but identical labels,
		// use this as a conversion look up table from one id to the other
		let newNodes = new Map()
		for (let BNode of bdata.nodes.get()) {
			if (BNode.isCluster) continue
			// for each node in the other map
			let ANode = data.nodes.get(BNode.id) // see whether there is a node in this map with the same id
			// if not, see whether there is a node in this map with the same label, and treat this node as the same as the node in the other map
			if (!ANode) {
				let sameLabelNodes = data.nodes
					.get()
					.filter((an) => an.label.replace(/\s/g, '') === BNode.label.replace(/\s/g, ''))
				if (sameLabelNodes.length > 1) {
					console.log(
						`%cMatching factors by label ('${BNode.label}'), but there are two or more factors with this label in this map`,
						'color: red',
					)
					alertMsg(
						`Matching factors by label ('${BNode.label}'), but there are two or more factors with this label in the map`,
						'warn',
					)
				}
				ANode = sameLabelNodes[0]
				if (ANode) {
					// map works both ways - OK since ids are unique
					substitutes.set(BNode.id, ANode.id)
					substitutes.set(ANode.id, BNode.id)
				}
			}
			if (ANode) {
				// if there is, check whether the label is the same
				if (ANode.label.replace(/\s/g, '') !== BNode.label.replace(/\s/g, '')) {
					// if not, make a clone of the other node with a new id
					logMerge(
						`'${ANode.label}' Factor in this map does not match Factor from other map with new label: '${BNode.label}'. Factor with new label added.`,
					)
					// generate a new id for BNode.  change border to dashed red.  Add it to the map
					let newNode = deepCopy(BNode)
					newNode.id = uuidv4()
					newNode.shapeProperties.borderDashes = true
					newNode.borderWidth = 4
					newNode.borderWidthSelected = 4
					newNode.color.border = '#ff0000'
					newNode.color.highlight.border = '#ff0000'
					newNode.x = ANode.x + 30
					newNode.y = ANode.y + 30
					// add it to this map
					nodesToAdd.push(newNode)
					// add to lookup table of existing node id to clone node id
					newNodes.set(BNode.id, newNode.id)
				} else {
					if (ANode.grp !== BNode.grp) {
						// label is the same, but style is not - just report this
						logMerge(
							`Style: '${ANode.grp}' does not match style: '${BNode.grp}' from other map for Factor: '${ANode.label}. Existing style retained.`,
						)
					}
					if (!object_equals(ANode.note, BNode.note)) {
						// if the note is different, change it to the note from the other map
						ANode.note = BNode.note
						logMerge(`Note for the Factor: '${ANode.label}' changed to the Note from the Factor in the other map`)
						nodesToAdd.push(ANode)
					}

				}
			} else {
				// the node is on the other map, but not on this one - add it.
				nodesToAdd.push(BNode)
				logMerge(`added new Factor: '${BNode.label}'`)
			}
		}
		data.nodes.update(nodesToAdd)

		bdata.edges.get().forEach((BEdge) => {
			// Some edges on the other map may have been going to/from nodes that have been cloned and given a new id.
			// Clone these edges, giving them the new from: or to: node ids and make them dashed.
			let newEdge = null
			if (newNodes.has(BEdge.from)) {
				// this edge goes from a node that has been cloned - adjust the from: id
				newEdge = deepCopy(BEdge)
				newEdge.from = newNodes.get(BEdge.from)
				// it might also go to a cloned node -if so, adjust the to: id
				if (newNodes.has(newEdge.to)) newEdge.to = newNodes.get(newEdge.to)
			} else if (newNodes.has(BEdge.to)) {
				// this edge goes to a cloned node
				newEdge = deepCopy(BEdge)
				newEdge.to = newNodes.get(BEdge.to)
			}
			if (newEdge) {
				// give the cloned edge a new id
				newEdge.id = uuidv4()
				// make the edge dashed, red and thick
				newEdge.dashes = true
				newEdge.width = 4
				newEdge.color.color = 'rgb(255, 0, 0)'
				edgesToAdd.push(newEdge)
				logMerge(
					`added Link between new Factor(s): '${data.nodes.get(newEdge.from).label}' to '${data.nodes.get(newEdge.to).label
					}'`,
				)
			}
			// now deal with the other map's edges
			let AEdge = data.edges.get(BEdge.id)
			if (!AEdge) {
				// check to see if there is a link in map A that goes from and to the same nodes as
				// this link in map B, although it has a different id, remembering that the map A
				// and map B nodes may have been matched by label, rather than id.
				let from = BEdge.from
				if (substitutes.get(from)) from = substitutes.get(from)
				let to = BEdge.to
				if (substitutes.get(to)) to = substitutes.get(to)
				let sameEdges = data.edges.get().filter((e) => e.from === from &amp;&amp; e.to === to)
				if (sameEdges) AEdge = sameEdges[0]
			}
			if (BEdge.label &amp;&amp; BEdge.label.trim() === '') BEdge.label = undefined
			let edgeName =
				BEdge.label || `from [${bdata.nodes.get(BEdge.from).label}] to [${bdata.nodes.get(BEdge.to).label}]`
			if (AEdge) {
				if (
					((AEdge.label &amp;&amp; AEdge.label.trim() !== '') || (BEdge.label &amp;&amp; BEdge.label.trim() !== '')) &amp;&amp;
					AEdge.label !== BEdge.label
				)
					logMerge(
						`Link with label: '${AEdge.label}' does not match link from other map with label: '${BEdge.label}'.  Existing label retained.`,
					)
				else {
					if (AEdge.grp !== BEdge.grp)
						logMerge(
							`Link with style: '${AEdge.grp}' does not match style: '${BEdge.grp}' from other map for link '${edgeName}'. Existing style retained.`,
						)
					if (!object_equals(AEdge.note, BEdge.note)) {
						AEdge.note = BEdge.note
						logMerge(`Note for Link: '${edgeName}' changed to the Note from the Link in the other map`)
						edgesToAdd.push(AEdge)
					}
				}
			} else {
				// if BEdge's from or to nodes have been substituted for a node in the A map
				// with the same label, change the from or to ids to the A map version
				if (substitutes.get(BEdge.from)) BEdge.from = substitutes.get(BEdge.from)
				if (substitutes.get(BEdge.to)) BEdge.to = substitutes.get(BEdge.to)
				edgesToAdd.push(BEdge)
				logMerge(`added new Link: '${edgeName}'`)
			}
		})
		// now check that all edges in the existing map are also in the other map
		data.edges.forEach((AEdge) => {
			let BEdge = bdata.edges.get(AEdge.id)
			if (!BEdge) {
				let from = AEdge.from
				if (substitutes.get(from)) from = substitutes.get(from)
				let to = AEdge.to
				if (substitutes.get(to)) to = substitutes.get(to)
				let sameEdges = bdata.edges.get().filter((e) => e.from === from &amp;&amp; e.to === to)
				if (sameEdges) BEdge = sameEdges[0]
			}
		})
		data.nodes.update(nodesToAdd)
		data.edges.update(edgesToAdd)
	})
	logHistory(history, 'Merge')

	function logMerge(action) {
		history += '&lt;br />' + action
	}
}

export function mergeRoom(otherRoom) {
	openOtherDoc(otherRoom)
	console.log('%cMerging map at %s (map A) with map at %s (map B)', 'font-weight: bold', room, otherRoom)
	bwsp.on('sync', (status) => {
		if (!status) return
		bNodesMap.forEach((n) => bdata.nodes.update(n))
		bEdgesMap.forEach((e) => bdata.edges.update(e))
		mergeMaps()
		bwsp.disconnect()
		console.log('Finished')
	})
	return 'Please wait...'
}

/**
 * Print to console the differences between the given map and the current map
 */
function diffMaps() {
	for (let BNode of bdata.nodes.get()) {
		if (BNode.isCluster) continue
		// for each node in the other map
		let ANode = data.nodes.get(BNode.id) // see whether there is a node in this map with the same id
		if (!ANode) {
			let sameLabelNodes = data.nodes
				.get()
				.filter((an) => an.label.replace(/\s/g, '') === BNode.label.replace(/\s/g, ''))
			if (sameLabelNodes.length > 1)
				console.log(
					`%cMatching factors by label [%c${inline(
						BNode.label,
					)}%c], but there are two or more factors with this label in this map`,
					'color: red',
					'color:green',
					'color:red',
				)
			else {
				if (sameLabelNodes.length === 1)
					console.log(
						`%cMatching factors by label [%c${inline(
							BNode.label,
						)}%c] because there is no pair of factors with the same id`,
						'color: black',
						'color:green',
						'color: black',
					)
			}
			ANode = sameLabelNodes[0]
		}
		if (ANode) {
			// if there is, check whether the label is the same
			if (ANode.label.replace(/\s/g, '') !== BNode.label.replace(/\s/g, '')) {
				console.log(
					`Factor label in map A: [%c${inline(ANode.label)}%c] does not match label in map B: [%c${inline(
						BNode.label,
					)}%c].`,
					'color:green',
					'color:black',
					'color:green',
					'color:black',
				)
			} else if (ANode.grp !== BNode.grp)
				// label is the same, but style is not - just report this
				console.log(
					`Factor style in map A : ${ANode.grp} does not match style in map B: ${BNode.grp
					} for Factor: [%c${inline(ANode.label)}%c]. `,
					'color:green',
					'color:black',
				)
		} else {
			// the node is on the other map, but not on this one - add it.
			console.log(`Factor: [%c${inline(BNode.label)}%c] in map B is not in map A`, 'color:green', 'color:black')
		}
	}
	// now check that all nodes in the existing map are also in the other map
	for (let ANode of data.nodes.get()) {
		if (ANode.isCluster) continue
		if (!bdata.nodes.get(ANode.id))
			console.log(`Factor: [%c${inline(ANode.label)}%c] in map A is not in map B`, 'color:green', 'color:black')
	}

	// now deal with the other map's edges
	bdata.edges.get().forEach((BEdge) => {
		let AEdge = data.edges.get(BEdge.id)
		if (BEdge.label &amp;&amp; BEdge.label.trim() === '') BEdge.label = undefined
		let edgeName = BEdge.label || `[${bdata.nodes.get(BEdge.from).label}] --> [${bdata.nodes.get(BEdge.to).label}]`
		if (AEdge) {
			if (
				((AEdge.label &amp;&amp; AEdge.label.trim() !== '') || (BEdge.label &amp;&amp; BEdge.label.trim() !== '')) &amp;&amp;
				AEdge.label !== BEdge.label
			)
				console.log(
					`Link label in map A: [%c${inline(AEdge.label)}%c] does not match label:[%c${inline(
						BEdge.label,
					)}%c] in map B.  `,
					'color:green',
					'color:black',
					'color:green',
					'color:black',
				)
			else if (AEdge.grp !== BEdge.grp)
				console.log(
					`Link style: '${AEdge.grp}' in map A does not match style: '${BEdge.grp
					}' in map B for link [%c${inline(edgeName)}%c]. `,
					'color:green',
					'color:black',
				)
		} else {
			console.log(
				`Map A does not include the link: %c${inline(edgeName)}%c in map B. `,
				'color:green',
				'color:black',
			)
		}
	})
	// now check that all edges in the existing map are also in the other map
	data.edges.forEach((AEdge) => {
		if (!bdata.edges.get(AEdge.id)) {
			let edgeName =
				(AEdge.label &amp;&amp; AEdge.label.trim() !== '') ||
				`[${data.nodes.get(AEdge.from).label}] --> [${data.nodes.get(AEdge.to).label}]`
			console.log(`Link %c${inline(edgeName)}%c in map A is not in map B`, 'color:green', 'color:black')
		}
	})
}
export function diffRoom(otherRoom) {
	openOtherDoc(otherRoom)
	console.log('%cComparing map at %s (map A) with map at %s (map B)', 'font-weight: bold', room, otherRoom)
	bwsp.on('sync', (status) => {
		if (!status) return
		bNodesMap.forEach((n) => bdata.nodes.update(n))
		bEdgesMap.forEach((e) => bdata.edges.update(e))
		diffMaps()
		bwsp.disconnect()
	})
	return true
}

/**
 * find a node with the given id and return its label
 * @param {string} id
 * @returns string
 */
export function nodeIdToLabel(id) {
	if (!id) return id
	let node = data.nodes.get(id)
	if (!node) return 'node not found'
	return node.label
}
/**
 * replace all white space with single space characters
 * @param {string} label
 * @returns string
 */
function inline(label) {
	return label.replace(/\s+/g, ' ').trim()
}
/**
 * anonymise a map by removing all user names
 */
export function anon() {
	let nodes = data.nodes.get()
	nodes.forEach((n) => {
		if (n.created) n.created = undefined
		if (n.modified) n.modified = undefined
	})
	data.nodes.update(nodes)
	let edges = data.edges.get()
	edges.forEach((e) => {
		if (e.created) e.created = undefined
		if (e.modified) e.modified = undefined
	})
	data.edges.update(edges)
}

export function sanityCheck(del = false) {
	// check all factors have labels
	data.nodes.get().forEach((n) => {
		if (!n.label || n.label === '' || n.label.trim() === '') {
			console.log('Bad factor:', n)
			if (del) {
				data.nodes.remove(n.id)
				console.log('Deleted factor', n)
			}
		}
	})
	// check all links have existing to and from factors
	data.edges.get().forEach((e) => {
		let ok = true
		if (!data.nodes.get(e.from)) {
			console.log('Missing from factor', e)
			ok = false
		}
		if (!data.nodes.get(e.to)) {
			console.log('Missing to factor', e)
			ok = false
		}
		if (!ok &amp;&amp; del) {
			data.edges.remove(e.id)
			console.log('Deleted edge: ', e)
		}
	})
}
window.sanityCheck = sanityCheck
</code></pre>
				</article>
			</section>
		</div>

		<br class="clear" />

		<footer>
			Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> on Thu Apr 24 2025
			19:18:15 GMT+0100 (British Summer Time) using the
			<a href="https://github.com/clenemt/docdash">docdash</a> theme.
		</footer>

		<script>
			prettyPrint()
		</script>
		<script src="scripts/polyfill.js"></script>
		<script src="scripts/linenumber.js"></script>
	</body>
</html>
