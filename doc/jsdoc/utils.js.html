<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>utils.js - Documentation</title>

		<script src="scripts/prettify/prettify.js"></script>
		<script src="scripts/prettify/lang-css.js"></script>
		<!--[if lt IE 9]>
			<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		<link type="text/css" rel="stylesheet" href="styles/prettify.css" />
		<link type="text/css" rel="stylesheet" href="styles/jsdoc.css" />
		<script src="scripts/nav.js" defer></script>

		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	</head>
	<body>
		<input type="checkbox" id="nav-trigger" class="nav-trigger" />
		<label for="nav-trigger" class="navicon-button x">
			<div class="navicon"></div>
		</label>

		<label for="nav-trigger" class="overlay"></label>

		<nav>
			<h2><a href="index.html">Home</a></h2>
			<h3>Classes</h3>
			<ul>
				<li><a href="module.exports.html">exports</a></li>
			</ul>
			<h3>Global</h3>
			<ul>
				<li><a href="global.html#LEGENDHEIGHT">LEGENDHEIGHT</a></li>
				<li><a href="global.html#MIN_WIDTH">MIN_WIDTH</a></li>
				<li><a href="global.html#SHORTLABELLEN">SHORTLABELLEN</a></li>
				<li><a href="global.html#TITLELISTLEN">TITLELISTLEN</a></li>
				<li><a href="global.html#addColumn">addColumn</a></li>
				<li><a href="global.html#addContextMenu">addContextMenu</a></li>
				<li><a href="global.html#addEventListeners">addEventListeners</a></li>
				<li><a href="global.html#addLabel">addLabel</a></li>
				<li><a href="global.html#addRollbackIcon">addRollbackIcon</a></li>
				<li><a href="global.html#addVec">addVec</a></li>
				<li><a href="global.html#alertMsg">alertMsg</a></li>
				<li><a href="global.html#analyse">analyse</a></li>
				<li><a href="global.html#anon">anon</a></li>
				<li><a href="global.html#applySampleToLink">applySampleToLink</a></li>
				<li>
					<a href="global.html#arrayBufferToString">arrayBufferToString</a>
				</li>
				<li><a href="global.html#arrowMove">arrowMove</a></li>
				<li><a href="global.html#asleep">asleep</a></li>
				<li><a href="global.html#autoLayout">autoLayout</a></li>
				<li><a href="global.html#betweenness">betweenness</a></li>
				<li><a href="global.html#betweenness1">betweenness1</a></li>
				<li><a href="global.html#bringToFront">bringToFront</a></li>
				<li><a href="global.html#buttonIsDisabled">buttonIsDisabled</a></li>
				<li><a href="global.html#cancelAdd">cancelAdd</a></li>
				<li><a href="global.html#cancelAlertMsg">cancelAlertMsg</a></li>
				<li><a href="global.html#cancelEdit">cancelEdit</a></li>
				<li><a href="global.html#cancelHiddenStyles">cancelHiddenStyles</a></li>
				<li><a href="global.html#cancelLoading">cancelLoading</a></li>
				<li><a href="global.html#cancelViewOnly">cancelViewOnly</a></li>
				<li><a href="global.html#changeCursor">changeCursor</a></li>
				<li><a href="global.html#changeRoom">changeRoom</a></li>
				<li><a href="global.html#checkComplete">checkComplete</a></li>
				<li>
					<a href="global.html#circleIntersectsRect">circleIntersectsRect</a>
				</li>
				<li><a href="global.html#clean">clean</a></li>
				<li><a href="global.html#cleanArray">cleanArray</a></li>
				<li><a href="global.html#cleanLocalStorage">cleanLocalStorage</a></li>
				<li><a href="global.html#clearLegend">clearLegend</a></li>
				<li><a href="global.html#clearMap">clearMap</a></li>
				<li><a href="global.html#clearPopUp">clearPopUp</a></li>
				<li><a href="global.html#clearStatusBar">clearStatusBar</a></li>
				<li><a href="global.html#closeFilter">closeFilter</a></li>
				<li>
					<a href="global.html#closeOptionsDialogs">closeOptionsDialogs</a>
				</li>
				<li><a href="global.html#cluster">cluster</a></li>
				<li><a href="global.html#clusterByAttribute">clusterByAttribute</a></li>
				<li><a href="global.html#clusterByColor">clusterByColor</a></li>
				<li><a href="global.html#clusterByLouvain">clusterByLouvain</a></li>
				<li><a href="global.html#clusterByStyle">clusterByStyle</a></li>
				<li><a href="global.html#clusterGroups">clusterGroups</a></li>
				<li><a href="global.html#clusterImage">clusterImage</a></li>
				<li><a href="global.html#collapseColGroup">collapseColGroup</a></li>
				<li><a href="global.html#collapseNotes">collapseNotes</a></li>
				<li><a href="global.html#colorEditor">colorEditor</a></li>
				<li><a href="global.html#connected">connected</a></li>
				<li>
					<a href="global.html#connectedComponents">connectedComponents</a>
				</li>
				<li><a href="global.html#convertDashes">convertDashes</a></li>
				<li><a href="global.html#convertData">convertData</a></li>
				<li><a href="global.html#convertEdge">convertEdge</a></li>
				<li><a href="global.html#convertEdgeBack">convertEdgeBack</a></li>
				<li><a href="global.html#convertNode">convertNode</a></li>
				<li><a href="global.html#convertNodeBack">convertNodeBack</a></li>
				<li><a href="global.html#copyAsText">copyAsText</a></li>
				<li>
					<a href="global.html#copyBackgroundToClipboard"
						>copyBackgroundToClipboard</a
					>
				</li>
				<li>
					<a href="global.html#copyHistoryToClipboard"
						>copyHistoryToClipboard</a
					>
				</li>
				<li><a href="global.html#copyTable">copyTable</a></li>
				<li><a href="global.html#copyToClipboard">copyToClipboard</a></li>
				<li>
					<a href="global.html#createTitleDropDown">createTitleDropDown</a>
				</li>
				<li><a href="global.html#deepCopy">deepCopy</a></li>
				<li>
					<a href="global.html#deleteActiveObjects">deleteActiveObjects</a>
				</li>
				<li><a href="global.html#deleteColumn">deleteColumn</a></li>
				<li><a href="global.html#deleteNode">deleteNode</a></li>
				<li><a href="global.html#deselectTool">deselectTool</a></li>
				<li><a href="global.html#diag">diag</a></li>
				<li><a href="global.html#diffMaps">diffMaps</a></li>
				<li><a href="global.html#display">display</a></li>
				<li><a href="global.html#displayHelp">displayHelp</a></li>
				<li><a href="global.html#displayNetPane">displayNetPane</a></li>
				<li>
					<a href="global.html#displayNoServerWarning"
						>displayNoServerWarning</a
					>
				</li>
				<li><a href="global.html#displayWhatsNew">displayWhatsNew</a></li>
				<li><a href="global.html#doSearch">doSearch</a></li>
				<li><a href="global.html#dragElement">dragElement</a></li>
				<li><a href="global.html#draw">draw</a></li>
				<li><a href="global.html#drawBadges">drawBadges</a></li>
				<li><a href="global.html#drawMinimap">drawMinimap</a></li>
				<li><a href="global.html#duplEdge">duplEdge</a></li>
				<li>
					<a href="global.html#edgeListToAdjMatrix">edgeListToAdjMatrix</a>
				</li>
				<li><a href="global.html#editEdge">editEdge</a></li>
				<li><a href="global.html#editLinkStyle">editLinkStyle</a></li>
				<li><a href="global.html#editNode">editNode</a></li>
				<li><a href="global.html#editNodeStyle">editNodeStyle</a></li>
				<li><a href="global.html#elem">elem</a></li>
				<li><a href="global.html#encodeHTMLEntities">encodeHTMLEntities</a></li>
				<li><a href="global.html#eqArray">eqArray</a></li>
				<li><a href="global.html#eraser">eraser</a></li>
				<li><a href="global.html#exactTime">exactTime</a></li>
				<li><a href="global.html#expandStylesObject">expandStylesObject</a></li>
				<li><a href="global.html#exportDOT">exportDOT</a></li>
				<li><a href="global.html#exportExcel">exportExcel</a></li>
				<li><a href="global.html#exportGEXF">exportGEXF</a></li>
				<li><a href="global.html#exportGML">exportGML</a></li>
				<li><a href="global.html#exportNotes">exportNotes</a></li>
				<li>
					<a href="global.html#factorSizeToPercent">factorSizeToPercent</a>
				</li>
				<li><a href="global.html#fit">fit</a></li>
				<li><a href="global.html#follow">follow</a></li>
				<li><a href="global.html#followUser">followUser</a></li>
				<li><a href="global.html#genAIEdge">genAIEdge</a></li>
				<li><a href="global.html#genAINode">genAINode</a></li>
				<li><a href="global.html#generateName">generateName</a></li>
				<li><a href="global.html#generateRoom">generateRoom</a></li>
				<li><a href="global.html#getArrows">getArrows</a></li>
				<li><a href="global.html#getButtonStatus">getButtonStatus</a></li>
				<li>
					<a href="global.html#getClipboardContents">getClipboardContents</a>
				</li>
				<li><a href="global.html#getDashes">getDashes</a></li>
				<li><a href="global.html#getIds">getIds</a></li>
				<li><a href="global.html#getLastPath">getLastPath</a></li>
				<li>
					<a href="global.html#getNodeGroupFromGroupLabel"
						>getNodeGroupFromGroupLabel</a
					>
				</li>
				<li><a href="global.html#getObjectData">getObjectData</a></li>
				<li><a href="global.html#getRadioVal">getRadioVal</a></li>
				<li><a href="global.html#getRandomData">getRandomData</a></li>
				<li>
					<a href="global.html#getScaleFreeNetwork">getScaleFreeNetwork</a>
				</li>
				<li>
					<a href="global.html#getSelectedAndFixedNodes"
						>getSelectedAndFixedNodes</a
					>
				</li>
				<li><a href="global.html#getWidthOfTitle">getWidthOfTitle</a></li>
				<li><a href="global.html#ghostCursor">ghostCursor</a></li>
				<li><a href="global.html#ghostFactor">ghostFactor</a></li>
				<li><a href="global.html#groupTitle">groupTitle</a></li>
				<li><a href="global.html#headerTickToggle">headerTickToggle</a></li>
				<li><a href="global.html#hexToRgba">hexToRgba</a></li>
				<li>
					<a href="global.html#hideFactorsWithStyle">hideFactorsWithStyle</a>
				</li>
				<li><a href="global.html#hideLinksWithStyle">hideLinksWithStyle</a></li>
				<li><a href="global.html#hideNavButtons">hideNavButtons</a></li>
				<li><a href="global.html#hideNodeAndEdges">hideNodeAndEdges</a></li>
				<li><a href="global.html#hideNotes">hideNotes</a></li>
				<li><a href="global.html#hideWhatsNew">hideWhatsNew</a></li>
				<li><a href="global.html#htmlEntities">htmlEntities</a></li>
				<li><a href="global.html#humanSize">humanSize</a></li>
				<li><a href="global.html#in_degree">in_degree</a></li>
				<li>
					<a href="global.html#initAligningGuidelines"
						>initAligningGuidelines</a
					>
				</li>
				<li><a href="global.html#initDraw">initDraw</a></li>
				<li><a href="global.html#initPopUp">initPopUp</a></li>
				<li><a href="global.html#initSample">initSample</a></li>
				<li>
					<a href="global.html#initialiseFactorTable">initialiseFactorTable</a>
				</li>
				<li>
					<a href="global.html#initialiseLinkTable">initialiseLinkTable</a>
				</li>
				<li><a href="global.html#initials">initials</a></li>
				<li><a href="global.html#initiateClone">initiateClone</a></li>
				<li><a href="global.html#inline">inline</a></li>
				<li><a href="global.html#intersect">intersect</a></li>
				<li><a href="global.html#invertColor">invertColor</a></li>
				<li><a href="global.html#isEmpty">isEmpty</a></li>
				<li><a href="global.html#isNotCluster">isNotCluster</a></li>
				<li><a href="global.html#isQuillEmpty">isQuillEmpty</a></li>
				<li><a href="global.html#jLouvain">jLouvain</a></li>
				<li><a href="global.html#keepPaneInWindow">keepPaneInWindow</a></li>
				<li><a href="global.html#legend">legend</a></li>
				<li><a href="global.html#legendSwitch">legendSwitch</a></li>
				<li><a href="global.html#lightOrDark">lightOrDark</a></li>
				<li><a href="global.html#linkEditCancel">linkEditCancel</a></li>
				<li><a href="global.html#linkEditSave">linkEditSave</a></li>
				<li><a href="global.html#linkEditSubmit">linkEditSubmit</a></li>
				<li>
					<a href="global.html#linkEditUpdateStyleSample"
						>linkEditUpdateStyleSample</a
					>
				</li>
				<li><a href="global.html#linkEditorHide">linkEditorHide</a></li>
				<li><a href="global.html#linkEditorShow">linkEditorShow</a></li>
				<li><a href="global.html#listFactors">listFactors</a></li>
				<li><a href="global.html#listLinks">listLinks</a></li>
				<li><a href="global.html#listen">listen</a></li>
				<li><a href="global.html#loadCSV">loadCSV</a></li>
				<li><a href="global.html#loadDOTfile">loadDOTfile</a></li>
				<li><a href="global.html#loadDrawIOfile">loadDrawIOfile</a></li>
				<li><a href="global.html#loadExcelfile">loadExcelfile</a></li>
				<li><a href="global.html#loadFile">loadFile</a></li>
				<li><a href="global.html#loadGEXFfile">loadGEXFfile</a></li>
				<li><a href="global.html#loadGML">loadGML</a></li>
				<li><a href="global.html#loadGraphML">loadGraphML</a></li>
				<li><a href="global.html#loadKumufile">loadKumufile</a></li>
				<li><a href="global.html#loadPRSMfile">loadPRSMfile</a></li>
				<li><a href="global.html#lockNode">lockNode</a></li>
				<li><a href="global.html#logHistory">logHistory</a></li>
				<li><a href="global.html#makeClusterNode">makeClusterNode</a></li>
				<li><a href="global.html#makeColor">makeColor</a></li>
				<li><a href="global.html#makeGroup">makeGroup</a></li>
				<li>
					<a href="global.html#makeNotesPanelResizeable"
						>makeNotesPanelResizeable</a
					>
				</li>
				<li><a href="global.html#makeOptionsDialog">makeOptionsDialog</a></li>
				<li><a href="global.html#mapTitle">mapTitle</a></li>
				<li><a href="global.html#markMapSaved">markMapSaved</a></li>
				<li><a href="global.html#maxScale">maxScale</a></li>
				<li><a href="global.html#mergeTranspose">mergeTranspose</a></li>
				<li><a href="global.html#mostFrequentString">mostFrequentString</a></li>
				<li><a href="global.html#nodeEditCancel">nodeEditCancel</a></li>
				<li><a href="global.html#nodeEditSave">nodeEditSave</a></li>
				<li><a href="global.html#nodeEditSubmit">nodeEditSubmit</a></li>
				<li>
					<a href="global.html#nodeEditUpdateStyleSample"
						>nodeEditUpdateStyleSample</a
					>
				</li>
				<li><a href="global.html#nodeEditorHide">nodeEditorHide</a></li>
				<li><a href="global.html#nodeEditorShow">nodeEditorShow</a></li>
				<li><a href="global.html#nodeIdToLabel">nodeIdToLabel</a></li>
				<li><a href="global.html#nodeList">nodeList</a></li>
				<li><a href="global.html#noteFilter">noteFilter</a></li>
				<li><a href="global.html#objectEquals">objectEquals</a></li>
				<li><a href="global.html#onexit">onexit</a></li>
				<li><a href="global.html#openCluster">openCluster</a></li>
				<li><a href="global.html#openNotesWindow">openNotesWindow</a></li>
				<li><a href="global.html#panCanvas">panCanvas</a></li>
				<li><a href="global.html#plusLink">plusLink</a></li>
				<li><a href="global.html#plusNode">plusNode</a></li>
				<li><a href="global.html#portrait">portrait</a></li>
				<li><a href="global.html#positionNotes">positionNotes</a></li>
				<li><a href="global.html#positionPopUp">positionPopUp</a></li>
				<li><a href="global.html#progressBar">progressBar</a></li>
				<li><a href="global.html#pushnew">pushnew</a></li>
				<li><a href="global.html#quillAccessor">quillAccessor</a></li>
				<li><a href="global.html#quillEditor">quillEditor</a></li>
				<li><a href="global.html#quillFormatter">quillFormatter</a></li>
				<li><a href="global.html#randomColour">randomColour</a></li>
				<li>
					<a href="global.html#reApplySampleToLinks">reApplySampleToLinks</a>
				</li>
				<li>
					<a href="global.html#reApplySampleToNodes">reApplySampleToNodes</a>
				</li>
				<li><a href="global.html#readSingleFile">readSingleFile</a></li>
				<li><a href="global.html#rebase">rebase</a></li>
				<li><a href="global.html#recalculateStats">recalculateStats</a></li>
				<li><a href="global.html#receiveEvent">receiveEvent</a></li>
				<li>
					<a href="global.html#recreateClusteringMenu"
						>recreateClusteringMenu</a
					>
				</li>
				<li><a href="global.html#redraw">redraw</a></li>
				<li><a href="global.html#refreshFromMap">refreshFromMap</a></li>
				<li><a href="global.html#refreshSampleLink">refreshSampleLink</a></li>
				<li><a href="global.html#refreshSampleNode">refreshSampleNode</a></li>
				<li><a href="global.html#removeAvatar">removeAvatar</a></li>
				<li><a href="global.html#removeFactorCursor">removeFactorCursor</a></li>
				<li>
					<a href="global.html#removeTitleDropDown">removeTitleDropDown</a>
				</li>
				<li><a href="global.html#renameUser">renameUser</a></li>
				<li><a href="global.html#resizeCanvas">resizeCanvas</a></li>
				<li><a href="global.html#restoreState">restoreState</a></li>
				<li><a href="global.html#rgbIsLight">rgbIsLight</a></li>
				<li><a href="global.html#rgbToArray">rgbToArray</a></li>
				<li><a href="global.html#rgba">rgba</a></li>
				<li><a href="global.html#rollback">rollback</a></li>
				<li><a href="global.html#round">round</a></li>
				<li><a href="global.html#saveChange">saveChange</a></li>
				<li><a href="global.html#saveEdge">saveEdge</a></li>
				<li><a href="global.html#saveLabel">saveLabel</a></li>
				<li><a href="global.html#saveNode">saveNode</a></li>
				<li><a href="global.html#savePRSMfile">savePRSMfile</a></li>
				<li><a href="global.html#saveState">saveState</a></li>
				<li><a href="global.html#saveStr">saveStr</a></li>
				<li><a href="global.html#saveUserName">saveUserName</a></li>
				<li><a href="global.html#search">search</a></li>
				<li><a href="global.html#searchTargets">searchTargets</a></li>
				<li><a href="global.html#seededRandom">seededRandom</a></li>
				<li><a href="global.html#selectClustering">selectClustering</a></li>
				<li>
					<a href="global.html#selectFactorsWithStyle"
						>selectFactorsWithStyle</a
					>
				</li>
				<li>
					<a href="global.html#selectLinksWithStyle">selectLinksWithStyle</a>
				</li>
				<li><a href="global.html#selectTool">selectTool</a></li>
				<li><a href="global.html#selectUsersItems">selectUsersItems</a></li>
				<li><a href="global.html#selectedLabels">selectedLabels</a></li>
				<li><a href="global.html#sendToBack">sendToBack</a></li>
				<li>
					<a href="global.html#setAnalysisButtonsFromRemote"
						>setAnalysisButtonsFromRemote</a
					>
				</li>
				<li>
					<a href="global.html#setButtonDisabledStatus"
						>setButtonDisabledStatus</a
					>
				</li>
				<li><a href="global.html#setButtonStatus">setButtonStatus</a></li>
				<li>
					<a href="global.html#setCanvasBackground">setCanvasBackground</a>
				</li>
				<li><a href="global.html#setEdgeHidden">setEdgeHidden</a></li>
				<li>
					<a href="global.html#setEndOfContenteditable"
						>setEndOfContenteditable</a
					>
				</li>
				<li>
					<a href="global.html#setFactorSizeFromPercent"
						>setFactorSizeFromPercent</a
					>
				</li>
				<li><a href="global.html#setFileName">setFileName</a></li>
				<li><a href="global.html#setFixed">setFixed</a></li>
				<li>
					<a href="global.html#setGroupBorderColor">setGroupBorderColor</a>
				</li>
				<li><a href="global.html#setIntersection">setIntersection</a></li>
				<li><a href="global.html#setLegend">setLegend</a></li>
				<li><a href="global.html#setMapTitle">setMapTitle</a></li>
				<li><a href="global.html#setNodeHidden">setNodeHidden</a></li>
				<li><a href="global.html#setRadioVal">setRadioVal</a></li>
				<li><a href="global.html#setUpAwareness">setUpAwareness</a></li>
				<li><a href="global.html#setUpBackground">setUpBackground</a></li>
				<li><a href="global.html#setUpFilter">setUpFilter</a></li>
				<li><a href="global.html#setUpPage">setUpPage</a></li>
				<li><a href="global.html#setUpPinchZoom">setUpPinchZoom</a></li>
				<li><a href="global.html#setUpSamples">setUpSamples</a></li>
				<li><a href="global.html#setUpSamplesMap">setUpSamplesMap</a></li>
				<li><a href="global.html#setUpShareDialog">setUpShareDialog</a></li>
				<li><a href="global.html#setUpSideDrawer">setUpSideDrawer</a></li>
				<li><a href="global.html#setUpTabs">setUpTabs</a></li>
				<li><a href="global.html#setUpToolbox">setUpToolbox</a></li>
				<li><a href="global.html#setUpTutorial">setUpTutorial</a></li>
				<li><a href="global.html#setUpUserName">setUpUserName</a></li>
				<li><a href="global.html#setvh">setvh</a></li>
				<li><a href="global.html#showAvatars">showAvatars</a></li>
				<li><a href="global.html#showClusterLinks">showClusterLinks</a></li>
				<li><a href="global.html#showEdgeData">showEdgeData</a></li>
				<li><a href="global.html#showGhostFactor">showGhostFactor</a></li>
				<li><a href="global.html#showHistory">showHistory</a></li>
				<li><a href="global.html#showNavButtons">showNavButtons</a></li>
				<li><a href="global.html#showNodeData">showNodeData</a></li>
				<li><a href="global.html#showNodeOrEdgeData">showNodeOrEdgeData</a></li>
				<li><a href="global.html#showNotesSwitch">showNotesSwitch</a></li>
				<li><a href="global.html#showOtherMouse">showOtherMouse</a></li>
				<li><a href="global.html#showPressed">showPressed</a></li>
				<li><a href="global.html#showSelected">showSelected</a></li>
				<li><a href="global.html#snapToGrid">snapToGrid</a></li>
				<li><a href="global.html#solve">solve</a></li>
				<li><a href="global.html#splitText">splitText</a></li>
				<li><a href="global.html#standardizeColor">standardizeColor</a></li>
				<li><a href="global.html#start">start</a></li>
				<li><a href="global.html#startY">startY</a></li>
				<li><a href="global.html#statusMsg">statusMsg</a></li>
				<li><a href="global.html#stepFinish">stepFinish</a></li>
				<li><a href="global.html#stepStart">stepStart</a></li>
				<li><a href="global.html#stepsEnd">stepsEnd</a></li>
				<li><a href="global.html#stopEdit">stopEdit</a></li>
				<li><a href="global.html#strip">strip</a></li>
				<li><a href="global.html#stripArray">stripArray</a></li>
				<li><a href="global.html#stripNL">stripNL</a></li>
				<li>
					<a href="global.html#styleEdgeContextMenu">styleEdgeContextMenu</a>
				</li>
				<li><a href="global.html#styleEdgeNames">styleEdgeNames</a></li>
				<li>
					<a href="global.html#styleNodeContextMenu">styleNodeContextMenu</a>
				</li>
				<li><a href="global.html#styleNodeNames">styleNodeNames</a></li>
				<li><a href="global.html#subVec">subVec</a></li>
				<li><a href="global.html#subtract">subtract</a></li>
				<li><a href="global.html#sumVec">sumVec</a></li>
				<li><a href="global.html#svg">svg</a></li>
				<li><a href="global.html#tickToggle">tickToggle</a></li>
				<li><a href="global.html#timeAndDate">timeAndDate</a></li>
				<li><a href="global.html#timekey">timekey</a></li>
				<li><a href="global.html#timestamp">timestamp</a></li>
				<li><a href="global.html#toggleDeleteButton">toggleDeleteButton</a></li>
				<li>
					<a href="global.html#toggleNodeStyleLock">toggleNodeStyleLock</a>
				</li>
				<li><a href="global.html#togglePanel">togglePanel</a></li>
				<li><a href="global.html#toolHandler">toolHandler</a></li>
				<li><a href="global.html#traceUsers">traceUsers</a></li>
				<li><a href="global.html#transpose">transpose</a></li>
				<li><a href="global.html#trophic">trophic</a></li>
				<li><a href="global.html#unCluster">unCluster</a></li>
				<li><a href="global.html#unFollow">unFollow</a></li>
				<li><a href="global.html#unGroup">unGroup</a></li>
				<li><a href="global.html#unSelect">unSelect</a></li>
				<li><a href="global.html#undirected">undirected</a></li>
				<li><a href="global.html#unlockAll">unlockAll</a></li>
				<li><a href="global.html#unlockEdge">unlockEdge</a></li>
				<li><a href="global.html#unlockNode">unlockNode</a></li>
				<li><a href="global.html#unselectTool">unselectTool</a></li>
				<li>
					<a href="global.html#updateActiveButtons">updateActiveButtons</a>
				</li>
				<li><a href="global.html#updateColumnTitle">updateColumnTitle</a></li>
				<li><a href="global.html#updateEdgeCellData">updateEdgeCellData</a></li>
				<li>
					<a href="global.html#updateFactorsOrLinksHiddenByStyle"
						>updateFactorsOrLinksHiddenByStyle</a
					>
				</li>
				<li><a href="global.html#updateFilter">updateFilter</a></li>
				<li>
					<a href="global.html#updateFromAndToLabels">updateFromAndToLabels</a>
				</li>
				<li>
					<a href="global.html#updateFromDrawingMap">updateFromDrawingMap</a>
				</li>
				<li><a href="global.html#updateFromRemote">updateFromRemote</a></li>
				<li><a href="global.html#updateLastSamples">updateLastSamples</a></li>
				<li><a href="global.html#updateLegend">updateLegend</a></li>
				<li><a href="global.html#updateLinkEditor">updateLinkEditor</a></li>
				<li><a href="global.html#updateNodeCellData">updateNodeCellData</a></li>
				<li><a href="global.html#updateNodeEditor">updateNodeEditor</a></li>
				<li><a href="global.html#updateSelection">updateSelection</a></li>
				<li><a href="global.html#upgradeFromV1">upgradeFromV1</a></li>
				<li><a href="global.html#uuidv4">uuidv4</a></li>
				<li><a href="global.html#yjsTrace">yjsTrace</a></li>
				<li><a href="global.html#zero">zero</a></li>
				<li><a href="global.html#zoomCanvas">zoomCanvas</a></li>
				<li><a href="global.html#zoomincr">zoomincr</a></li>
				<li><a href="global.html#zoomnet">zoomnet</a></li>
				<li><a href="global.html#zoomscroll">zoomscroll</a></li>
			</ul>
		</nav>

		<div id="main">
			<h1 class="page-title">utils.js</h1>

			<section>
				<article>
					<pre
						class="prettyprint source linenums"
					><code>/*********************************************************************************************************************  

PRSM Participatory System Mapper 

	Copyright (C) 2022  Nigel Gilbert prsm@prsm.uk

This software is licenced under the PolyForm Noncommercial License 1.0.0

&lt;https://polyformproject.org/licenses/noncommercial/1.0.0>

See the file LICENSE.md for details.

This module provides a set of utility functions used widely within the PRSM code.  
**********************************************************************************************************************/

import iro from '@jaames/iro'

const MANUALURL = './doc/help/doc_build/manual/Introduction.html'
/**
 * attach an event listener
 *
 * @param {string} id - id of the element on which to hang the event listener
 * @param {string} event
 * @param {function} callback
 * @param {object} options
 */
export function listen(id, event, callback, options) {
  elem(id).addEventListener(event, callback, options)
}

/**
 * return the HTML element with the id
 * @param {string} id
 */
export function elem(id) {
  return document.getElementById(id)
}

/**
 * Add an item to an array if it doesn't already exist
 * @param {Array} array - the array to add to
 * @param {any} item - the item to add
 * @returns {Array} the updated array
 */
export function pushnew(array, item) {
  if (array) {
    if (!array.includes(item)) array.push(item)
  } else array = [item]
  return array
}

/**
 * Create a random scale free network, used only for testing and demoing
 * Taken from the vis-network distribution
 *
 * Created by Alex on 5/20/2015.
 */
export function getScaleFreeNetwork(nodeCount) {
  const nodes = []
  const edges = []
  const connectionCount = []

  // randomly create some nodes and edges
  for (let i = 0; i &lt; nodeCount; i++) {
    nodes.push({
      id: String(i),
      label: String(i),
      grp: 'group0',
      value: 1,
    })

    connectionCount[i] = 0

    // create edges in a scale-free-network way
    if (i === 1) {
      const from = i
      const to = 0
      edges.push({
        from: from.toString(),
        to: to.toString(),
        grp: 'edge0',
      })
      connectionCount[from]++
      connectionCount[to]++
    } else if (i > 1) {
      const conn = edges.length * 2
      const rand = Math.floor(seededRandom() * conn)
      let cum = 0
      let j = 0
      while (j &lt; connectionCount.length &amp;&amp; cum &lt; rand) {
        cum += connectionCount[j]
        j++
      }

      const from = i
      const to = j
      edges.push({
        from: from.toString(),
        to: to.toString(),
        grp: 'edge0',
      })
      connectionCount[from]++
      connectionCount[to]++
    }
  }

  return {
    nodes,
    edges,
  }
}

let randomSeed = 764 // Math.round(Math.random()*1000)

/**
 * Generate a seeded random number
 * @returns {number} a random number between 0 and 1                                           ...
 */
function seededRandom() {
  const x = Math.sin(randomSeed++) * 10000
  return x - Math.floor(x)
}

/**
 * return a GUID
 */
export function uuidv4() {
  return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, (c) =>
    (c ^ (crypto.getRandomValues(new Uint8Array(1))[0] &amp; (15 >> (c / 4)))).toString(16)
  )
}
/**
 * return true if obj has no properties, i.e. is {}
 * @param {Object} obj
 * @returns true or false
 */
export function isEmpty(obj) {
  for (const p in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, p)) return false
  }
  return true
}
/*
 * Deep merge two or more objects together.
 * (c) 2019 Chris Ferdinandi, MIT License, https://gomakethings.com
 * if two objects have the same property, the value of the second one is used
 * @param   {Object[]}   objects  The objects to merge together
 * @returns {Object}            A new, merged, object
 */
export function deepMerge() {
  // Setup merged object
  const newObj = {}

  // Merge the object into the newObj object
  function merge(obj) {
    for (const prop in obj) {
      if (Object.prototype.hasOwnProperty.call(obj, prop)) {
        // If property is an object, merge properties
        if (Object.prototype.toString.call(obj[prop]) === '[object Object]') {
          newObj[prop] = deepMerge(newObj[prop], obj[prop])
        } else {
          newObj[prop] = obj[prop]
        }
      }
    }
  }

  // Loop through each object and conduct a merge
  for (let i = 0; i &lt; arguments.length; i++) {
    merge(arguments[i])
  }

  return newObj
}

/**
 * returns a deep copy of the object
 * original replaced by new built-in
 * @param {Object} obj
 */
export function deepCopy(obj) {
  /* 	if (typeof obj !== 'object' || obj === null) {
		return obj
	}
	if (obj instanceof Array) {
		return obj.reduce((arr, item, i) => {
			arr[i] = deepCopy(item)
			return arr
		}, [])
	}
	if (obj instanceof Object) {
		return Object.keys(obj).reduce((newObj, key) => {
			newObj[key] = deepCopy(obj[key])
			return newObj
		}, {})
	} */
  return structuredClone(obj)
}
window.deepCopy = deepCopy
/**
 * compare two objects for deep equality
 * fast but doesn't cater for obscure cases
 * adapted from https://stackoverflow.com/questions/1068834/object-comparison-in-javascript
 * @param {Object} x
 * @param {Object} y
 */
export function objectEquals(x, y) {
  if (x === y) return true
  // if both x and y are null or undefined and exactly the same

  if (!(x instanceof Object) || !(y instanceof Object)) return false
  // if they are not strictly equal, they both need to be Objects

  if (x.constructor !== y.constructor) return false
  // they must have the exact same prototype chain, the closest we can do is
  // test their constructor.

  for (const p in x) {
    if (!Object.prototype.hasOwnProperty.call(x, p)) continue
    // other properties were tested using x.constructor === y.constructor

    if (!Object.prototype.hasOwnProperty.call(y, p)) return false
    // allows to compare x[ p ] and y[ p ] when set to undefined

    if (x[p] === y[p]) continue
    // if they have the same strict value or identity then they are equal

    if (typeof x[p] !== 'object') return false
    // Numbers, Strings, Functions, Booleans must be strictly equal

    if (!objectEquals(x[p], y[p])) return false
    // Objects and Arrays must be tested recursively
  }

  for (const p in y) {
    if (Object.prototype.hasOwnProperty.call(y, p) &amp;&amp; !Object.prototype.hasOwnProperty.call(x, p)) {
      return false
    }
  }
  // allows x[ p ] to be set to undefined

  return true
}
window.objectEquals = objectEquals
/**
 * return a copy of an object, with the properties in the object propsToRemove removed
 * @param {Object} source
 * @param {Object} propsToRemove
 */
export function clean(source, propsToRemove) {
  const out = {}
  for (const key in source) {
    if (!(key in propsToRemove)) out[key] = source[key]
  }
  return out
}
/**
 * remove the given properties from all the objects in the array
 * @param {Array} arr array of objects
 * @param {string} propsToRemove
 */
export function cleanArray(arr, propsToRemove) {
  return arr.map((item) => {
    return clean(item, propsToRemove)
  })
}
/**
 * return a copy of an object that only includes the properties that are in allowed
 * @param {Object} obj the object to copy
 * @param {array} allowed list of allowed properties
 */
export function strip(obj, allowed) {
  return allowed.reduce((a, e) => {
    a[e] = obj[e]
    return a
  }, {})
}
/**
 * return an array of objects, each stripped to only include the allowed properties
 * @param {array} arr
 * @param {array} allowed
 * @returns {array} array of stripped objects
 */
export function stripArray(arr, allowed) {
  return arr.map((item) => strip(item, allowed))
}
/**
 * divide txt into lines to make it roughly square, with a
 * maximum width of width characters, but not breaking words and
 * respecting embedded line breaks (\n).
 * @param {string} txt
 * @param {number} width
 * @returns {string} the split text
 */
export function splitText(txt, width = 10) {
  let lines = ''
  const chunks = txt.trim().split('\n')
  chunks.forEach((chunk) => {
    const words = chunk.trim().split(/\s/)
    const nChars = chunk.trim().length
    if (nChars > 2 * width) width = Math.floor(Math.sqrt(nChars))

    for (let i = 0, linelength = 0; i &lt; words.length; i++) {
      lines += words[i]
      if (i === words.length - 1) break
      linelength += words[i].length
      if (linelength > width) {
        lines += '\n'
        linelength = 0
      } else lines += ' '
    }
    lines += '\n'
  })
  return lines.trim()
}
/**
 * Performs intersection operation between called set and otherSet
 * @param {Set} otherSet
 * @returns {Set}
 */
export function setIntersection(thisSet, otherSet) {
  const intersectionSet = new Set()
  for (const el of otherSet) if (thisSet.has(el)) intersectionSet.add(el)
  return intersectionSet
}
/**
 * Find the most frequent string in an array.
 * @param {array} arr array of strings
 * @returns string
 */
export function mostFrequentString(arr) {
  if (!arr.length) return null // handle empty array

  const counts = new Map()

  // Count occurrences
  for (const str of arr) {
    counts.set(str, (counts.get(str) || 0) + 1)
  }

  // Find the highest frequency
  const maxCount = Math.max(...counts.values())

  // Collect all strings with that frequency
  const mostFrequent = [...counts.entries()]
    .filter(([, count]) => count === maxCount)
    .map(([str]) => str)

  // Pick one at random if there are ties
  const randomIndex = Math.floor(Math.random() * mostFrequent.length)
  return mostFrequent[randomIndex]
}
/**
 * Convert a factor size into a percent (with any size below 30 as zero), for the input range slider
 * @param {Integer} size
 * @returns {Integer} percent
 */
export function factorSizeToPercent(size) {
  const fSize = (size - 20) / 2.5
  return isNaN(fSize) || fSize &lt; 30 ? 0 : fSize
}
/**
 * Set the factor size according to the input range slider value (less then 5% is treated as the normal size)
 * @param {object} node
 * @param {integer} percent
 */
export function setFactorSizeFromPercent(node, percent) {
  if (percent &lt; 5) {
    if (node.widthConstraint?.minimum || node.heightConstraint?.minimum) return
    node.size = 25
    node.heightConstraint = node.widthConstraint = false
  } else {
    node.heightConstraint = node.widthConstraint = node.size = percent * 2.5 + 20
  }
}
/**
 * convert from style object properties to dashed border menu selection
 * @param {any} bDashes select menu value
 * @param {number} bWidth border width
 */
export function getDashes(bDashes, bWidth) {
  if (bWidth === 0) return 'none'
  if (bDashes === false) return 'solid'
  if (bDashes === true) return 'dashed'
  if (Array.isArray(bDashes)) {
    if (bDashes[0] === 10) return 'dashedLinks'
    return 'dots'
  }
  return null
}
/**
 * Convert from dashed menu selection to style object properties
 * @param {string} val
 */
export function convertDashes(val) {
  switch (val) {
    case 'dashed': // dashes [5,15] for node borders
      return true
    case 'dashedLinks': // dashes for links
      return [10, 10]
    case 'solid': // solid
      return false
    case 'none': //solid, zero width
      return false
    case 'dots':
      return [2, 8]
    default:
      return false
  }
}
/**
 * allow user to drag the element that has a header element that acts as the handle
 * @param {HTMLElement} el
 * @param {HTMLElement} header
 */
export function dragElement(el, header) {
  let isDragging = false
  let startPosX = 0
  let startPosY = 0
  let lastPosX = 0
  let lastPosY = 0
  let width = 0
  let height = 0

  function onPointerDown(ev) {
    // Don't start dragging if clicking on interactive button elements
    const target = ev.target
    // Check if the target or any of its ancestors (up to the header) has the interactiveButton class
    let element = target
    while (element &amp;&amp; element !== header) {
      if (element.classList &amp;&amp; element.classList.contains('interactiveButton')) {
        return // Don't start dragging
      }
      element = element.parentElement
    }
    // Start dragging (allow clicking on header or any of its children)
    isDragging = true
    startPosX = ev.clientX
    startPosY = ev.clientY
    lastPosX = el.offsetLeft
    lastPosY = el.offsetTop
    width = el.offsetWidth
    height = el.offsetHeight
    header.setPointerCapture(ev.pointerId)
    el.style.cursor = 'move'
  }

  function onPointerMove(ev) {
    if (!isDragging) return

    // Calculate delta from start position
    const deltaX = ev.clientX - startPosX
    const deltaY = ev.clientY - startPosY

    // Calculate new position with boundary constraints
    let posX = lastPosX + deltaX
    if (posX &lt; 0) posX = 0
    if (posX > window.innerWidth - width) posX = window.innerWidth - width

    let posY = lastPosY + deltaY
    if (posY &lt; 0) posY = 0
    if (posY > window.innerHeight - height) posY = window.innerHeight - height

    // Move element to new position
    el.style.left = posX + 'px'
    el.style.top = posY + 'px'
  }

  function onPointerUp(ev) {
    if (!isDragging) return
    isDragging = false
    el.style.cursor = 'auto'
    header.releasePointerCapture(ev.pointerId)
  }

  function onPointerCancel(ev) {
    if (!isDragging) return
    isDragging = false
    el.style.cursor = 'auto'
    header.releasePointerCapture(ev.pointerId)
  }

  header.addEventListener('pointerdown', onPointerDown)
  header.addEventListener('pointermove', onPointerMove)
  header.addEventListener('pointerup', onPointerUp)
  header.addEventListener('pointercancel', onPointerCancel)
}
/**
 * Create a context menu that pops up when elem is right clicked
 * NB:  Use something like addEventListener('pointerdown', (event) => {
 *        if (event.button === 2) { addContextMenu(elem, menu)
 * }})
 * to run this.
 *
 * @param {HTMLElement} elem click this to get a context menu
 * @param {array} menu array of menu options: ([{label: string, action: function to call when this option selected} {...}])
 */
export function addContextMenu(elem, menu) {
  const menuEl = document.createElement('div')
  menuEl.classList.add('context-menu')
  document.body.appendChild(menuEl)

  const removeMenu = () => {
    if (menuEl.parentNode) {
      document.body.removeChild(menuEl)
    }
    document.removeEventListener('click', handleClickOutside)
  }

  // Handler for clicks outside the menu
  const handleClickOutside = (event) => {
    if (!menuEl.contains(event.target)) {
      removeMenu()
    }
  }
  // Handler for clicks on a menu item
  elem.addEventListener('contextmenu', (event) => {
    event.preventDefault()
    const { clientX: mouseX, clientY: mouseY } = event
    const posX =
      window.innerWidth - mouseX &lt; menuEl.offsetWidth + 4
        ? window.innerWidth - menuEl.offsetWidth - 4
        : mouseX
    const posY =
      window.innerHeight - mouseY &lt; menuEl.offsetHeight + 4
        ? window.innerHeight - menuEl.offsetHeight - 4
        : mouseY
    menuEl.style.top = `${posY}px`
    menuEl.style.left = `${posX}px`
    menuEl.classList.remove('visible')
    setTimeout(() => {
      menuEl.classList.add('visible')
      // Attach click listener after menu becomes visible
      document.addEventListener('click', handleClickOutside)
    })
  })

  menu.forEach((item) => {
    const { label, action } = item
    const option = document.createElement('div')
    option.classList.add('item')
    option.innerHTML = label
    option.addEventListener('click', () => {
      removeMenu()
      action()
    })
    option.addEventListener('contextmenu', (event) => event.preventDefault())
    menuEl.appendChild(option)
  })
}

const SEA_CREATURES = Object.freeze([
  'walrus',
  'seal',
  'fish',
  'shark',
  'clam',
  'coral',
  'whale',
  'crab',
  'lobster',
  'starfish',
  'eel',
  'dolphin',
  'squid',
  'jellyfish',
  'ray',
  'shrimp',
  'herring',
  'angler',
  'mackerel',
  'salmon',
  'urchin',
  'anemone',
  'morel',
  'axolotl',
  'blobfish',
  'tubeworm',
  'seabream',
  'seaweed',
  'anchovy',
  'cod',
  'barramundi',
  'carp',
  'crayfish',
  'haddock',
  'hake',
  'octopus',
  'plaice',
  'sardine',
  'skate',
  'sturgeon',
  'swordfish',
  'whelk',
])

const ADJECTIVES = Object.freeze([
  'cute',
  'adorable',
  'lovable',
  'happy',
  'sandy',
  'bubbly',
  'friendly',
  'drifting',
  'huge',
  'big',
  'small',
  'giant',
  'massive',
  'tiny',
  'nippy',
  'odd',
  'perfect',
  'rude',
  'wonderful',
  'agile',
  'beautiful',
  'bossy',
  'candid',
  'carnivorous',
  'clever',
  'cold',
  'cold-blooded',
  'colorful',
  'cuddly',
  'curious',
  'cute',
  'dangerous',
  'deadly',
  'domestic',
  'dominant',
  'energetic',
  'fast',
  'feisty',
  'ferocious',
  'fierce',
  'fluffy',
  'friendly',
  'furry',
  'fuzzy',
  'grumpy',
  'hairy',
  'heavy',
  'herbivorous',
  'jealous',
  'large',
  'lazy',
  'loud',
  'lovable',
  'loving',
  'malicious',
  'maternal',
  'mean',
  'messy',
  'nocturnal',
  'noisy',
  'nosy',
  'picky',
  'playful',
  'poisonous',
  'quick',
  'rough',
  'sassy',
  'scaly',
  'short',
  'shy',
  'slimy',
  'slow',
  'small',
  'smart',
  'smelly',
  'soft',
  'spikey',
  'stinky',
  'strong',
  'stubborn',
  'submissive',
  'tall',
  'tame',
  'tenacious',
  'territorial',
  'tiny',
  'vicious',
  'warm',
  'wild',
])

const colors = [
  '#00ffff',
  '#f0ffff',
  '#f5f5dc',
  '#0000ff',
  '#a52a2a',
  '#00008b',
  '#008b8b',
  '#a9a9a9',
  '#006400',
  '#bdb76b',
  '#8b008b',
  '#556b2f',
  '#ff8c00',
  '#9932cc',
  '#8b0000',
  '#e9967a',
  '#9400d3',
  '#ff00ff',
  '#ffd700',
  '#008000',
  '#4b0082',
  '#f0e68c',
  '#add8e6',
  '#e0ffff',
  '#90ee90',
  '#d3d3d3',
  '#ffb6c1',
  '#ffffe0',
  '#00ff00',
  '#ff00ff',
  '#800000',
  '#000080',
  '#808000',
  '#ffa500',
  '#ffc0cb',
  '#800080',
  '#ff0000',
  '#c0c0c0',
  '#ffff00',
]

const random = (items) => items[(Math.random() * items.length) | 0]

/**
 * Determine whether the RGB color is light or not
 * http://www.w3.org/TR/AERT#color-contrast
 * @param  {number}  r               Red
 * @param  {number}  g               Green
 * @param  {number}  b               Blue
 * @param  {number}  differencePoint
 * @return {boolean}
 */
export const rgbIsLight = (r, g, b, differencePoint = 128) =>
  (r * 299 + g * 587 + b * 114) / 1000 >= differencePoint

/**
 * return a random colour, with a flag to show whether the color is light or dark,
 *  to suggest whether text applied should be white or black
 * @returns {Object} {color: string, isLight: boolean}
 */
function randomColour() {
  const color = random(colors)
  const rgb = color.replace('#', '')
  return {
    color,
    isLight: rgbIsLight(
      parseInt(rgb.substring(0, 2), 16),
      parseInt(rgb.substring(2, 4), 16),
      parseInt(rgb.substring(4, 6), 16),
      128
    ),
  }
}

const capitalize = (string) => string[0].toUpperCase() + string.slice(1)

/**
 * return a random fancy name for an avatar, with a random colour
 */
export function generateName() {
  const name = capitalize(random(ADJECTIVES)) + ' ' + capitalize(random(SEA_CREATURES))

  return {
    ...randomColour(),
    name,
    anon: true,
    asleep: false,
  }
}

/*----------- Status messages ---------------------------------------
 */
/**
 * show status message at the bottom of the window
 * @param {string} msg
 */
export function statusMsg(msg) {
  elem('statusBar').innerHTML = htmlEntities(msg)
}
// CSpell: ignore dontFade
/**
 * show alert messages at the bottom of the window
 * @param {string} msg
 * @param {string} [status] type of msg - info, warn, error
 * @param {boolean} [dontFade] if true, don't fade the message in and out
 */
export function alertMsg(msg, status, dontFade = false) {
  const errMsgElement = elem('errMsg')
  switch (status) {
    case 'info':
      errMsgElement.style.backgroundColor = 'black'
      errMsgElement.style.color = 'white'
      break
    case 'warn':
      errMsgElement.style.backgroundColor = '#FFEB3B'
      errMsgElement.style.color = 'black'
      break
    case 'error':
      errMsgElement.style.backgroundColor = 'red'
      errMsgElement.style.color = 'white'
      break
    default:
      console.log('Unknown status in alertMsg: ' + status)
      return
  }
  errMsgElement.innerHTML = msg
  if (dontFade) {
    errMsgElement.style.opacity = 1
  } else {
    listen('errMsg', 'animationend', () => {
      elem('errMsg').classList.remove('fadeInAndOut')
    })
    errMsgElement.classList.add('fadeInAndOut')
  }
}
/**
 * cancel the alert message
 */
export function cancelAlertMsg() {
  elem('errMsg').style.opacity = 0
}
/**
 * replace special characters with their HTML entity codes
 * @param {string} str
 */
function htmlEntities(str) {
  return String(str)
    .replace(/&amp;/g, '&amp;amp;')
    .replace(/&lt;/g, '&amp;lt;')
    .replace(/>/g, '&amp;gt;')
    .replace(/"/g, '&amp;quot;')
    .replace(/'/g, '&amp;quot;')
}
/**
 * remove any previous message from the status bar
 */
export function clearStatusBar() {
  statusMsg(' ')
}
/**
 * shorten the label if necessary and add an ellipsis
 * @param {string} label text to shorten
 * @param {number} maxLength if longer than this, cut the excess
 */
const SHORTLABELLEN = 25 // when listing node labels, use ellipsis after this number of chars

export function shorten(label, maxLength = SHORTLABELLEN) {
  return label.length > maxLength ? label.substring(0, maxLength) + '...' : label
}
/**
 * return the initials of the given name as a string: Nigel Gilbert -> NG
 * @param {string} name
 */
export function initials(name) {
  return name
    .replace(/[^A-Za-z0-9À-ÿ ]/gi, '')
    .replace(/ +/gi, ' ')
    .match(/(^\S\S?|\b\S)?/g)
    .join('')
    .match(/(^\S|\S$)?/g)
    .join('')
    .toUpperCase()
}

/**********************************************************colours ************************************************** */

const hiddenOpacity = 0.1
/**
 * set this node to its 'hidden' appearance (very faint), or restore it to its usual appearance
 * @param {object} node
 * @param {boolean} hide
 * @returns {object} node
 */
export function setNodeHidden(node, hide) {
  node.nodeHidden = hide
  node.opacity = hide ? hiddenOpacity : 1.0
  if (node.font.color.charAt(0) === '#') node.font.color = hexToRgba(node.font.color)
  node.font.color = rgba(node.font.color, hide ? hiddenOpacity : 1.0)
  return node
}

/**
 * covert a hex color string such as #123456 to an rgba string
 * @param {string} hex
 * @param {string} alpha
 * @returns string
 */
export function hexToRgba(hex, alpha = 1) {
  hex = hex.replace('#', '')
  if (hex.length === 3) {
    hex = hex
      .split('')
      .map((c) => c + c)
      .join('')
  }
  const [r, g, b] = [0, 2, 4].map((i) => parseInt(hex.slice(i, i + 2), 16))
  return `rgba(${r}, ${g}, ${b}, ${alpha})`
}

/**
 * set this edge to its 'hidden' appearance (very faint), or restore it to its usual appearance
 * @param {object} edge
 * @param {boolean} hide
 * @returns {object} edge
 */
export function setEdgeHidden(edge, hide) {
  edge.edgeHidden = hide
  edge.color.opacity = hide ? hiddenOpacity : 1.0
  if (!edge.font.color) edge.font.color = 'rgba(0,0,0,1)'
  edge.font.color = rgba(edge.font.color, hide ? hiddenOpacity : 1.0)
  return edge
}

/**
 * convert an rgb(a) string to rgba with given alpha value
 */
function rgba(rgb, alpha) {
  if (rgb.indexOf('a') === -1) rgb = rgb.replace('rgb', 'rgba').replace(')', ',0.0)')
  return rgb.replace(/[^,]*$/, ` ${alpha})`)
}
/**
 * return the hex value for the CSS color in str (which may be a color name, e.g. white, or a hex number
 * or any other legal CSS color value)
 * @param {string} str
 */
export function standardizeColor(str) {
  if (!str) return '#000000'
  if (str.charAt(0) === '#') return str
  const ctx = document.createElement('canvas').getContext('2d')
  ctx.fillStyle = str
  return ctx.fillStyle
}
/**
 * convert a color string to an array of numbers
 * e.g. 'rgb(255, 0, 0)' -> [255, 0, 0]
 * @param {string} rgb
 * @returns {array} array of numbers
 */
export function rgbToArray(rgb) {
  const values = rgb.slice(rgb.indexOf('(') + 1, rgb.indexOf(')')).split(',')
  return values.map((value) => {
    return parseInt(value)
  })
}

/**
 * return the inverse/complementary colour
 * @param {string} color as a hex string
 * @returns hex string
 */
export function invertColor(color) {
  return '#' + ('000000' + (0xffffff ^ parseInt(color.substring(1), 16)).toString(16)).slice(-6)
}

/**
 * return a random color as an rgb string, e.g. 'rgb(246,121,16)'
 * if a seed (number) is provided, the same color will be generated each time for that seed
 * if no seed is provided, a different color will be generated each time
 * @param {number} [seed]
 * @returns {string} rgb(r,g,b)
 */
export function makeColor(seed) {
  // Mulberry32 seeded PRNG
  function mulberry32(a) {
    return function () {
      a |= 0
      a = (a + 0x6d2b79f5) | 0
      let t = Math.imul(a ^ (a >>> 15), 1 | a)
      t = (t + Math.imul(t ^ (t >>> 7), 61 | t)) ^ t
      return ((t ^ (t >>> 14)) >>> 0) / 4294967296
    }
  }

  if (typeof seed === 'number') {
    // Seeded PRNG (deterministic but well distributed)
    const rand = mulberry32(seed)
    const r = Math.floor(rand() * 256)
    const g = Math.floor(rand() * 256)
    const b = Math.floor(rand() * 256)
    return `rgb(${r}, ${g}, ${b})`
  } else {
    // Non-deterministic path
    const r = Math.floor(Math.random() * 256)
    const g = Math.floor(Math.random() * 256)
    const b = Math.floor(Math.random() * 256)
    return `rgb(${r}, ${g}, ${b})`
  }
}

window.makeColor = makeColor
/**
 * Determine whether a color is light or dark (so text in a contrasting color can be overlaid)
 * from https://awik.io/determine-color-bright-dark-using-javascript/
 * @param {string} color
 * @returns 'light' or 'dark'
 */
export function lightOrDark(color) {
  // Variables for red, green, blue values
  let r, g, b

  // Check the format of the color, HEX or RGB?
  if (color.match(/^rgb/)) {
    // If RGB --> store the red, green, blue values in separate variables
    color = color.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/)

    r = color[1]
    g = color[2]
    b = color[3]
  } else {
    // If hex --> Convert it to RGB: http://gist.github.com/983661
    color = +('0x' + color.slice(1).replace(color.length &lt; 5 &amp;&amp; /./g, '$&amp;$&amp;'))

    r = color >> 16
    g = (color >> 8) &amp; 255
    b = color &amp; 255
  }

  // HSP (Highly Sensitive Poo) equation from http://alienryderflex.com/hsp.html
  const hsp = Math.sqrt(0.299 * (r * r) + 0.587 * (g * g) + 0.114 * (b * b))

  // Using the HSP value, determine whether the color is light or dark
  if (hsp > 127.5) {
    return 'light'
  } else {
    return 'dark'
  }
}

/* --------------------color picker -----------------------------*/

export class CP {
  constructor() {
    this.container = document.createElement('div')
    this.container.className = 'color-picker-container'
    this.container.id = 'colorPicker'
    const controls = document.createElement('div')
    controls.id = 'colorPickerControls'
    this.container.appendChild(controls)
    document.querySelector('body').insertAdjacentElement('beforeend', this.container)

    // see https://iro.js.org/guide.html#getting-started
    this.colorPicker = new iro.ColorPicker('#colorPickerControls', {
      width: 160,
      color: 'rgba(255, 255, 255, 1)',
      borderWidth: 1,
      borderColor: 'rgba(255, 255, 255,1)',
      margin: 6,
      layout: [
        {
          component: iro.ui.Wheel,
          options: {
            borderColor: '#ffffff',
          },
        },
        {
          component: iro.ui.Slider,
          options: {
            borderColor: '#000000',
            sliderType: 'value',
            padding: 2,
            handleRadius: 4,
          },
        },
        {
          component: iro.ui.Slider,
          options: {
            borderColor: '#000000',
            sliderType: 'alpha',
            padding: 2,
            handleRadius: 4,
          },
        },
      ],
    })

    // set up a grid of squares to hold last 8 selected colors
    this.colorCache = document.createElement('div')
    this.colorCache.id = 'colorCache'
    this.colorCache.className = 'color-cache'
    for (let i = 0; i &lt; 8; i++) {
      const c = document.createElement('div')
      c.id = 'color' + i
      c.className = 'cached-color'
      // prefill with standard colours
      c.style.backgroundColor = [
        'rgba(255, 0, 0,1)',
        'rgba(0, 255, 0,1)',
        'rgb(0, 0, 255)',
        'rgba(255, 255, 0,1)',
        'rgb(255, 255, 255)',
        'rgba(0, 0, 0,1)',
        'rgba(154, 219, 180,1)',
        'rgba(219, 110, 103,1)',
      ][i]
      c.addEventListener('click', (e) => {
        const color = e.target.style.backgroundColor
        if (color) this.colorPicker.color.rgbaString = e.target.style.backgroundColor
      })
      this.colorCache.appendChild(c)
    }
    document
      .getElementById('colorPickerControls')
      .insertAdjacentElement('afterend', this.colorCache)
  }

  /**
   * attach a color picker to an element to recolour the background to that element
   * @param {string} wellId the id of the DOM element to attach the color picker to
   * @param {string} callback - function to call when the color has been chosen, with that color as argument
   */
  createColorPicker(wellId, callback, onChange) {
    const well = elem(wellId)
    well.style.backgroundColor = '#ffffff'
    // add listener to display picker when well clicked
    well.addEventListener('click', (event) => {
      this.container.style.display = 'block'
      const netPane = elem('net-pane').getBoundingClientRect()
      // locate picker so it does not go outside netPane
      let top = event.clientY + well.offsetHeight + 10
      if (top > netPane.bottom - this.container.offsetHeight) {
        top = netPane.bottom - this.container.offsetHeight - 10
      }
      if (top &lt; netPane.top) top = netPane.top + 10
      let left = event.clientX - this.container.offsetWidth / 2
      if (left &lt; netPane.left) left = netPane.left + 10
      if (left > netPane.right - this.container.offsetWidth) {
        left = netPane.right - this.container.offsetWidth - 10
      }
      this.container.style.top = `${top}px`
      this.container.style.left = `${left}px`
      this.container.well = well
      this.container.callback = callback
      this.container.onChange = onChange
      this.colorPicker.color.rgbaString = well.style.backgroundColor
      this.onclose = this.closeColorPicker.bind(this)
      document.addEventListener('click', this.onclose, true)

      // update well as color is changed
      this.colorPicker.on('color:change', (color) => {
        well.style.backgroundColor = color.rgbaString
        if (onChange) onChange()
      })
    })
  }
  /**
   * Report chosen colour when user clicks outside of picker (and well)
   * Hide the picker and save the colour choice in the previously selected colour grid
   * @param {event} event
   */
  closeColorPicker(event) {
    if (!(this.container.contains(event.target) || this.container.well.contains(event.target))) {
      this.container.style.display = 'none'
      document.removeEventListener('click', this.onclose, true)
      const color = this.container.well.style.backgroundColor
      // save the chosen color for future selection if it is not already there
      this.saveColor(color)

      const callback = this.container.callback
      if (callback) callback(color)
      this.colorPicker.off('color:change')
    }
  }
  /**
   * Save the color in the previously selected colour grid, if not already saved
   * into a free slot, or if there isn't one shift the current colours to the left
   * and save the new at the right end
   * @param {string} color
   */
  saveColor(color) {
    const saveds = this.colorCache.children
    for (let i = 0; i &lt; 8; i++) {
      if (saveds[i].style.backgroundColor === color) return
    }
    for (let i = 0; i &lt; 8; i++) {
      if (saveds[i].style.backgroundColor === '') {
        saveds[i].style.backgroundColor = color
        return
      }
    }
    for (let i = 0, j = 1; j &lt; 8; i++, j++) {
      saveds[i].style.backgroundColor = saveds[j].style.backgroundColor
    }
    saveds[7].style.backgroundColor = color
  }
}

/********************************************************************** text ************************************************ */
/**
 * Returns a nicely formatted Date (or time if the date is today), given a Time value (from Date() )
 * @param {number} utc
 * @param {boolean} full - if true, don't use Today in date
 */
export function timeAndDate(utc, full = false) {
  const time = new Date()
  time.setTime(utc)
  if (!full &amp;&amp; time.toDateString() === new Date().toDateString()) {
    // return Today, 12:34
    return (
      'Today, ' +
      time.toLocaleString('en-GB', {
        hour: '2-digit',
        minute: '2-digit',
      })
    )
  }
  if (!full &amp;&amp; time.getFullYear() === new Date().getFullYear()) {
    // return 12 Sept, 12:34
    return time.toLocaleString('en-GB', {
      day: '2-digit',
      month: 'short',
      hour: '2-digit',
      minute: '2-digit',
    })
  }
  // return 12 Sep 2023, 12:34
  return time
    .toLocaleString('en-GB', {
      day: '2-digit',
      month: 'short',
      year: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
    })
    .replace('Sept', 'Sep')
}
/**
 * positions the caret at the end of text in a contenteditable div
 * @param {*} contentEditableElement
 */
export function setEndOfContenteditable(contentEditableElement) {
  const range = document.createRange() //Create a range (a range is a like the selection but invisible)
  range.selectNodeContents(contentEditableElement) //Select the entire contents of the element with the range
  range.collapse(false) //collapse the range to the end point. false means collapse to end rather than the start
  const selection = window.getSelection() //get the selection object (allows you to change selection)
  selection.removeAllRanges() //remove any selections already made
  selection.addRange(range) //make the range you have just created the visible selection
}

/**
 * @returns a string with current time to the nearest millisecond
 */
export function exactTime(time) {
  const d = time ? new Date(time) : new Date()
  return `${d.toLocaleTimeString()}:${d.getMilliseconds()} `
}

export function capitalizeFirstLetter(string) {
  return string ? string.charAt(0).toUpperCase() + string.slice(1) : ''
}
export function lowerFirstLetter(string) {
  return string ? string.charAt(0).toLowerCase() + string.slice(1) : ''
}
/**
 * convert a number of bytes to a human-readable string
 * @param {number} bytes integer to convert
 * @param {boolean} isDecimal use base 10 (true) or base 2 (false)
 * @returns {string} e.g. humanSize(1929637) => 1.9MB
 */
export function humanSize(bytes, isDecimal = true) {
  if (bytes === 0) return '0B'

  const decimalUnits = ['B', 'KB', 'MB', 'GB', 'TB', 'PB']
  const binaryUnits = ['B', 'KiB', 'MiB', 'GiB', 'TiB', 'PiB']

  const base = isDecimal ? 1000 : 1024
  const units = isDecimal ? decimalUnits : binaryUnits

  const i = Math.floor(Math.log(bytes) / Math.log(base))
  const size = bytes / Math.pow(base, i)

  const formatted = size % 1 === 0 ? size.toString() : size.toFixed(1)
  return `${formatted}${units[i]}`
}
/**
 * test whether the editor has any content
 * (could be an empty string or a Quill insert operation of just a single newline character)
 * @param {object} quill editor
 * @returns boolean
 */
export function isQuillEmpty(quill) {
  if ((quill.getContents()['ops'] || []).length !== 1) {
    return false
  }
  return quill.getText().trim().length === 0
}
/**
 * Replace all \n, \r with a space
 * @param {string} str
 * @returns string
 */
export function stripNL(str) {
  return str.replace(/\r?\n|\r/g, ' ')
}

/**
 * encode characters such as &amp; to HTML entities such as &amp;amp; to
 * make the string XML compliant. Only deals with common entities.
 * @param {string} text
 * @returns string
 */
export function encodeHTMLEntities(text) {
  return text.replace(
    /[&amp;&lt;>"']/g,
    (match) =>
      ({
        '&amp;': '&amp;amp;',
        '&lt;': '&amp;lt;',
        '>': '&amp;gt;',
        '"': '&amp;quot;',
        "'": '&amp;#39;',
      })[match]
  )
}

/**
 * display help page in a separate window
 */
export function displayHelp() {
  window.open(MANUALURL, 'helpWindow')
}
/**
 * remove any crud in Local storage
 * @param {*} preserve - list of items in local storage to keep
 */
export async function cleanLocalStorage(preserve = ['doneIntro', 'seenWN', 'myName', 'recents']) {
  // remove all local storage items that are not in the list
  const keys = Object.keys(localStorage)
  keys.forEach((key) => {
    if (!preserve.includes(key)) localStorage.removeItem(key)
  })
  // remove all IndexDB databases (we don't use them any more) except localforage
  indexedDB.databases().then((dbs) =>
    dbs.forEach((db) => {
      if (db.name !== 'localforage') indexedDB.deleteDatabase(db.name)
    })
  )
}
</code></pre>
				</article>
			</section>
		</div>

		<br class="clear" />

		<footer>
			Documentation generated by
			<a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Tue Feb 17
			2026 18:29:48 GMT+0100 (Central European Standard Time) using the
			<a href="https://github.com/clenemt/docdash">docdash</a> theme.
		</footer>

		<script>
			prettyPrint()
		</script>
		<script src="scripts/polyfill.js"></script>
		<script src="scripts/linenumber.js"></script>
	</body>
</html>
